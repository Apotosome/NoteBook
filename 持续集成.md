

#  Devops Gitæ¦‚è¿°



## Devops

â€‹	å¼€å‘  development       è¿ç»´     operations 

- Devopsèƒ½å¹²ä»€ä¹ˆï¼šæå‡äº§å“è´¨é‡

- 1. è‡ªåŠ¨åŒ–æµ‹è¯•
  2. é›†æˆæµ‹è¯•
  3. ä»£ç è´¨é‡ç®¡ç†å·¥å…·
  4. ç¨‹åºå‘˜é¼“åŠ±å¸ˆ

- Devopså¦‚ä½•å®ç°

  è®¾è®¡æ¶æ„è§„åˆ’-ä»£ç çš„å­˜å‚¨-æ„å»º-æµ‹è¯•ã€é¢„ç”Ÿäº§ã€éƒ¨ç½²ã€ç›‘æ§

  

## Gitç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ

- ç®€ä»‹

- 1. ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿæ˜¯ä¸€ç§è®°å½•ä¸€ä¸ªæˆ–è‹¥å¹²ä¸ªæ–‡ä»¶å†…å®¹å˜åŒ–,ä»¥ä¾¿å°†æ¥æŸ¥é˜…ç‰¹å®šç‰ˆæœ¬å†…å®¹æƒ…å†µçš„ç³»ç»Ÿ 

  2. è®°å½•æ–‡ä»¶çš„æ‰€æœ‰å†å²å˜åŒ–      

  3. éšæ—¶å¯æ¢å¤åˆ°ä»»ä½•ä¸€ä¸ªå†å²çŠ¶æ€

  4. å¤šäººåä½œå¼€å‘

     

- å¸¸è§çš„ç‰ˆæœ¬ç®¡ç†å·¥å…·

- 1. SVN

     é›†ä¸­å¼çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ,åªæœ‰ä¸€ä¸ªä¸­å¤®æ•°æ®ä»“åº“,å¦‚æœä¸­å¤®æ•°æ®ä»“åº“æŒ‚äº†æˆ–è€…ä¸å¯è®¿é—®,æ‰€æœ‰çš„ä½¿ç”¨è€…æ— æ³•ä½¿ç”¨SVN,æ— æ³•è¿›è¡Œæäº¤æˆ–å¤‡ä»½æ–‡ä»¶ã€‚

     <img src="Gitç¬”è®°.assets/image-20210420234032436.png" alt="image-20210420234032436" style="zoom:50%;" />

  2. Git 

     åˆ†å¸ƒå¼çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ,åœ¨æ¯ä¸ªä½¿ç”¨è€…ç”µè„‘ä¸Šå°±æœ‰ä¸€ä¸ªå®Œæ•´çš„æ•°æ®ä»“åº“,æ²¡æœ‰ç½‘ç»œä¾ç„¶å¯ä»¥ä½¿ç”¨Gitã€‚å½“ç„¶ä¸ºäº†ä¹ æƒ¯åŠå›¢é˜Ÿåä½œ,ä¼šå°†æœ¬åœ°æ•°æ®åŒæ­¥åˆ°GitæœåŠ¡å™¨æˆ–è€… Githubç­‰ä»£ç ä»“åº“ã€‚

     <img src="Gitç¬”è®°.assets/image-20210420234102406.png" alt="image-20210420234102406" style="zoom:50%;" />



##Gitå®‰è£…éƒ¨ç½²

### ç³»ç»Ÿç¯å¢ƒå‡†å¤‡

- CentOS

  ![image-20210420234253759](Gitç¬”è®°.assets/image-20210420234253759.png)

- MacOS

  ```bash
  (base) MacBook-Pro:~ jin$ git --version
  git version 2.21.1 (Apple
  ```

### GItå®‰è£…éƒ¨ç½²

1. ![image-20210420234656411](Gitç¬”è®°.assets/image-20210420234656411.png)

2. åˆ›å»ºä¸€ä¸ªå…¨å±€ç”¨æˆ·åã€å…¨å±€é‚®ç®±ä½œä¸ºé…ç½®ä¿¡æ¯

   ```bash
   # MacOS
   git config --global user.name 'sora01'    #é…ç½®gitä½¿ç”¨ç”¨æˆ· 
   git config --global user.email 'sora01@qq.com'   #é…ç½®gitä½¿ç”¨é‚®ç®±
   git config --global color.ui true   #è¯­æ³•é«˜äº®
   ```

3. Gitåˆå§‹åŒ–

   åˆå§‹åŒ–å·¥ä½œç›®å½•ã€å¯¹å·²å­˜åœ¨çš„ç›®å½•æˆ–è€…å¯¹å·²å­˜åœ¨çš„ç›®å½•éƒ½å¯è¿›è¡Œåˆå§‹åŒ–

   1. åˆå§‹åŒ–

      ```bash
      [sora @ sora-localhost ~]  mkdir data
      [sora @ sora-localhost ~]  cd data/
      [sora @ sora-localhost ~/data]  git init      #åˆå§‹åŒ–
      Initialized empty Git repository in /home/sora/data/.git/
      
      [sora @ sora-localhost ~/data]  ll -a
      total 4
      drwxrwxr-x   3 sora sora   18 Apr 21 23:43 .
      drwx------. 17 sora sora 4096 Apr 21 23:42 ..
      drwxrwxr-x   7 sora sora  119 Apr 21 23:43 .git
      ```

   2. æŸ¥çœ‹å·¥ä½œåŒºçŠ¶æ€

      ```bash
      git status		#æŸ¥çœ‹å·¥ä½œåŒºçŠ¶æ€
      
      [sora @ sora-localhost ~/data]  tree .git/
      .git/
      â”œâ”€â”€ branches			#åˆ†æ”¯ç›®å½•
      â”œâ”€â”€ config				#å®šä¹‰é¡¹ç›®ç‰¹æœ‰çš„é…ç½®é€‰é¡¹
      â”œâ”€â”€ description		#ä»…ä¾› git webç¨‹åºä½¿ç”¨
      â”œâ”€â”€ HEAD					#æŒ‡ç¤ºå½“å‰çš„åˆ†æ”¯
      â”œâ”€â”€ hooks					#åŒ…å«gité’©å­æ–‡ä»¶
      â”‚   â”œâ”€â”€ applypatch-msg.sample
      â”‚   â”œâ”€â”€ commit-msg.sample
      â”‚   â”œâ”€â”€ post-update.sample
      â”‚   â”œâ”€â”€ pre-applypatch.sample
      â”‚   â”œâ”€â”€ pre-commit.sample
      â”‚   â”œâ”€â”€ prepare-commit-msg.sample
      â”‚   â”œâ”€â”€ pre-push.sample
      â”‚   â”œâ”€â”€ pre-rebase.sample
      â”‚   â””â”€â”€ update.sample
      â”œâ”€â”€ info					#åŒ…å«ä¸€ä¸ªå…¨å±€æ’é™¤æ–‡ä»¶( excludeæ–‡ä»¶)
      â”‚   â””â”€â”€ exclude
      â”œâ”€â”€ objects				#å­˜æ”¾æ‰€æœ‰æ•°æ®å†…å®¹
      â”‚   â”œâ”€â”€ info
      â”‚   â””â”€â”€ pack
      â””â”€â”€ refs					#å­˜æ”¾æŒ‡å‘æ•°æ®(åˆ†æ”¯)çš„æäº¤å¯¹è±¡çš„æŒ‡é’ˆ
          â”œâ”€â”€ heads
          â””â”€â”€ tags
      #â””â”€â”€ index ä¿å­˜æš‚å­˜åŒºä¿¡æ¯,åœ¨æ‰§è¡Œ git initlçš„æ—¶å€™,è¿™ä¸ªæ–‡ä»¶è¿˜æ²¡æœ‰
      ```

      

# Gitå¸¸è§„ä½¿ç”¨

##åˆ›å»ºæ•°æ®-æäº¤æ•°æ®

<img src="Gitç¬”è®°.assets/image-20210422101548471.png" alt="image-20210422101548471" style="zoom: 33%;" />

## GItåŸºç¡€å‘½ä»¤

### æ·»åŠ æ–‡ä»¶

````bash
[root @ sora-localhost ~/data]  touch a b c
[root @ sora-localhost ~/data]  git status
# Untracked files
#       a
#       b
#       c
[root @ sora-localhost ~/data]  git add a			   #æ·»åŠ æ–‡ä»¶åˆ°æš‚å­˜åŒº
# Changes to be committed:
#       new file:   a
#
# Untracked files:
#       b
#       c
[root @ sora-localhost ~/data]  git add .     	#æ·»åŠ å½“å‰æ‰€æœ‰æ–‡ä»¶åˆ°æš‚å­˜åŒº 
# Changes to be committed:
#
#       new file:   a
#       new file:   b
#       new file:   c

````
### åˆ é™¤æ–‡ä»¶
```bash
[root @ sora-localhost ~/data]  git rm --cached c 		#æ’¤å‡ºæš‚å­˜åŒº
rm 'c'
# Changes to be committed:
#       new file:   a
#       new file:   b
#
# Untracked files:
#
#       c
[root @ sora-localhost ~/data]  git rm -f b			#åŒæ—¶åˆ é™¤æš‚å­˜åŒºå’Œå·¥ä½œç›®å½•çš„æ–‡ä»¶
```
### æäº¤æ–‡ä»¶
```bash
[root @ sora-localhost ~/data]  git commit -m "add newfile a"			#ä»æš‚å­˜åŒºæäº¤åˆ°æœ¬åœ°ä»“åº“
      [master (root-commit) 5c35cc1] add newfile a
       1 file changed, 0 insertions(+), 0 deletions(-)
       create mode 100644 a
[root @ sora-localhost ~/data]  git status 
      # On branch master
      nothing to commit, working directory clean
```

- å°ç»“:å¦‚ä½•çœŸæ­£æ„ä¹‰ä¸Šé€šè¿‡ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿç®¡ç†æ–‡ä»¶
  1. å·¥ä½œç›®å½•å¿…é¡»æœ‰ä¸ªä»£ç æ–‡ä»¶
  
  2. é€šè¿‡`git add <fi1e>`æ·»åŠ åˆ°æš‚å­˜åŒºåŸŸ
  
  3. é€šè¿‡ `git commit  -m  "ä½ è‡ªå·±è¾“å…¥çš„ä¿¡æ¯"`æ·»åŠ åˆ°æœ¬åœ°ä»“åº“
  
     

###ä¿®æ”¹æ–‡ä»¶åç§°

```bash
[root @ sora-localhost ~/data]  git mv a.txt a			#gitå‘½ä»¤ç›´æ¥æ›´æ”¹åç§°
# Changes to be committed:
#       renamed:    a.txt -> a
[root @ sora-localhost ~/data]  git commit -m "rename a.txt a"
```

### æ–‡ä»¶æ¯”å¯¹

```bash
[root @ sora-localhost ~/data]  echo 'soraä½ å¥½!' >a
[root @ sora-localhost ~/data]  git diff 		#æ¯”å¯¹å·¥ä½œç›®å½•å’Œæš‚å­˜åŒºæœ‰ä»€ä¹ˆä¸åŒ
    diff --git a/a b/a
    index e69de29..90d8bba 100644
    --- a/a
    +++ b/a
    @@ -0,0 +1 @@
    +soraä½ å¥½!
    
    
[root @ sora-localhost ~/data]  git add a		
[root @ sora-localhost ~/data]  git diff 		#ç”±äºæ·»åŠ åˆ°æš‚å­˜åŒº å› æ­¤å·¥ä½œç›®å½•å’Œæš‚å­˜åŒºç›¸åŒ æ— è¿”å›
[root @ sora-localhost ~/data]  git diff --cached			#æ¯”å¯¹æš‚å­˜åŒºå’Œæœ¬åœ°ä»“åº“æœ‰ä»€ä¹ˆä¸åŒ
    diff --git a/a b/a
    index e69de29..90d8bba 100644
    --- a/a
    +++ b/a
    @@ -0,0 +1 @@
    +soraä½ å¥½!
    
    
[root @ sora-localhost ~/data]  git commit -m "add greet"
    [master 364af5a] add greet
     1 file changed, 1 insertion(+)
[root @ sora-localhost ~/data]  git diff
[root @ sora-localhost ~/data]  git diff --cached		#ç”±äºæäº¤åˆ°æœ¬åœ°ä»“åº“ å› æ­¤æœ¬åœ°ä»“åº“å’Œæš‚å­˜åŒºç›¸åŒ 
```

```bash
[root @ sora-localhost ~/data]  echo 123456 >> a 
[root @ sora-localhost ~/data]  git commit -am "add greet2"  
#å¦‚æœæŸä¸ªæ–‡ä»¶å·²ç»è¢«ä»“åº“ç®¡ç†,å¦‚æœåœ¨æ›´æ”¹æ­¤æ–‡ä»¶ç›´æ¥éœ€è¦ä¸€æ¡å‘½ä»¤æäº¤å³å¯
    [master 4245e96] add greet2
     1 file changed, 1 insertion(+)
[root @ sora-localhost ~/data]  git diff --cached
```

### æŸ¥çœ‹å†å²å¿«ç…§

```bash
[root @ sora-localhost ~/data]  git log
      commit 4245e962027f9db38f4bc7dfe36f5f7089af228b   # å“ˆå¸Œå€¼
      Author: sora02 <sora02@qq.com>										# ä½œè€…ä¿¡æ¯
      Date:   Thu Apr 22 12:05:35 2021 +0800						# æ—¶é—´
          add greet2																		# æè¿°ä¿¡æ¯

[root @ sora-localhost ~/data]  git log --oneline				# ä¸€è¡Œç®€å•çš„æ˜¾ç¤º Commitä¿¡æ¯
      4245e96 add greet2	
      364af5a add greet

[root @ sora-localhost ~/data]  git log --oneline --decorate			# æ˜¾ç¤ºå½“å‰çš„æŒ‡é’ˆæŒ‡å‘å“ªé‡Œ
      4245e96 (HEAD, master) add greet2
      364af5a add greet
      
[root @ sora-localhost ~/data]  git log  -p							# æ˜¾ç¤ºå…·ä½“å†…å®¹çš„å˜åŒ–
[root @ sora-localhost ~/data]  git log  -1							# åªæ˜¾ç¤º1æ¡å†…å®¹
```



### æ¢å¤å†å²æ•°æ®

```bash
[root @ sora-localhost ~/data]  git reset --hard 364af5a			 # å›æ»šæ•°æ®åˆ°æŸä¸€ä¸ªæäº¤
			HEAD is now at 364af5a add greet

[root @ sora-localhost ~/data]  git reflog 							# å¯ä»¥æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯çš„æ‰€æœ‰æ“ä½œè®°å½•
      364af5a HEAD@{0}: reset: moving to 364af5a
      4245e96 HEAD@{1}: commit: add greet2
      364af5a HEAD@{2}: commit: add greet
      35ecfd5 HEAD@{3}: commit: rename a.txt a
      c1cdef6 HEAD@{4}: commit: rename a a.txt
      5c35cc1 HEAD@{5}: commit (initial): add newfile a
```



## Gitåˆ†æ”¯

â€‹		**åˆ†æ”¯**å³æ˜¯å¹³è¡Œç©ºé—´,å‡è®¾ä½ åœ¨ä¸ºæŸä¸ªæ‰‹æœºç³»ç»Ÿç ”å‘æ‹ç…§åŠŸèƒ½,ä»£ç å·²ç»å®Œæˆäº†80%,ä½†å¦‚æœå°†è¿™ä¸å®Œæ•´çš„ä»£ç ç›´æ¥æäº¤åˆ°gitä»“åº“ä¸­,åˆæœ‰å¯èƒ½å½±å“åˆ°å…¶ä»–äººçš„å·¥ä½œ,æ­¤æ—¶æˆ‘ä»¬ä¾¿å¯ä»¥åœ¨è¯¥è½¯ä»¶çš„é¡¹ç›®ä¹‹ä¸Šåˆ›å»ºä¸€ä¸ªåå«â€æ‹ç…§åŠŸèƒ½â€çš„åˆ†æ”¯,è¿™ç§åˆ†æ”¯åªä¼šå±äºä½ è‡ªå·±,è€Œå…¶ä»–äººçœ‹ä¸åˆ°,ç­‰ä»£ç ç¼–å†™å®Œæˆåå†ä¸åŸæ¥çš„é¡¹ç›®ä¸»åˆ†æ”¯åˆå¹¶ä¸‹å³å¯,è¿™æ ·å³èƒ½ä¿è¯ä»£ç ä¸ä¸¢å¤±,åˆä¸å½±å“å…¶ä»–äººçš„å·¥ä½œã€‚

![image-20210422135553437](Gitç¬”è®°.assets/image-20210422135553437.png)

â€‹		ä¸€èˆ¬åœ¨å®é™…çš„é¡¹ç›®å¼€å‘ä¸­,æˆ‘ä»¬è¦å°½é‡ä¿è¯ mastersåˆ†æ”¯æ˜¯éå¸¸ç¨³å®šçš„,ä»…ç”¨äºå‘å¸ƒæ–°ç‰ˆæœ¬,å¹³æ—¶ä¸è¦éšä¾¿ç›´æ¥ä¿®æ”¹é‡Œé¢çš„æ•°æ®æ–‡ä»¶ã€‚

â€‹		è€Œå·¥ä½œçš„æ—¶å€™åˆ™å¯ä»¥æ–°å»ºä¸åŒçš„å·¥ä½œåˆ†æ”¯,ç­‰åˆ°å·¥ä½œå®Œæˆååœ¨**åˆå¹¶**åˆ° masteråˆ†æ”¯ä¸Šé¢,æ‰€ä»¥å›¢é˜Ÿçš„åˆä½œåˆ†æ”¯çœ‹èµ·æ¥ä¼šåƒä¸Šé¢å›¾é‚£æ ·ã€‚

### åˆ›å»º æŸ¥çœ‹

```bash
[root @ sora-localhost ~/data]  git log --oneline --decorate	# æ˜¾ç¤ºå½“å‰çš„æŒ‡é’ˆæŒ‡å‘å“ªé‡Œ
      4245e96 (HEAD, master) add greet2
      364af5a add greet

[root @ sora-localhost ~/data]  git branch testing								# åˆ›å»ºåˆ†æ”¯
[root @ sora-localhost ~/data]  git branch												# æŸ¥çœ‹åˆ†æ”¯
      * master
        testing
```



### åˆ‡æ¢åˆ†æ”¯

```bash
[root @ sora-localhost ~/data]  git checkout testing 							# åˆ‡æ¢åˆ†æ”¯
      Switched to branch 'testing'
[root @ sora-localhost ~/data]  git branch 
        master
      * testing
```

### åˆ é™¤åˆ†æ”¯

```bash
[root @ sora-localhost ~/data]  git branch -d testing  							# åˆ é™¤åˆ†æ”¯
      Deleted branch testing (was 4245e96).
[root @ sora-localhost ~/data]  git branch 
			* master
```



### æ“çºµåˆ†æ”¯

![image-20210422151330684](Gitç¬”è®°.assets/image-20210422151330684.png)

```bash
## Step1.
[root @ sora-localhost ~/data]  touch aaa ...bbb...ccc
# çœç•¥git add, git commitæ“ä½œ

## Step2.
[root @ sora-localhost ~/data]  git checkout -b testing						# åˆ›å»ºå¹¶åˆ‡æ¢åˆ°åˆ†æ”¯
			Switched to a new branch 'testing'
[root @ sora-localhost ~/data]  git branch 
        master
      * testing
      
[root @ sora-localhost ~/data]  git log --oneline --decorate
			44e28b5 (HEAD, testing, master) add ccc
			
## Step3.
[root @ sora-localhost ~/data]  touch testing-add
[root @ sora-localhost ~/data]  git add .
[root @ sora-localhost ~/data]  git commit -m 'add newfile testing-add'
[root @ sora-localhost ~/data]  git log --oneline --decorate
      3b3844f (HEAD, testing) add newfile testing-add
      44e28b5 (master) add ccc

## Step4.
[root @ sora-localhost ~/data]  git checkout master 
[root @ sora-localhost ~/data]  touch master-eee
[root @ sora-localhost ~/data]  git add .
[root @ sora-localhost ~/data]  git commit  -m "add newfile master-eee"
[root @ sora-localhost ~/data]  git log --oneline --decorate
			c8dc512 (HEAD, master) add newfile master-eee
```

![image-20210422152424990](Gitç¬”è®°.assets/image-20210422152424990.png)



### åˆå¹¶åˆ†æ”¯

```bash
## Step5 6.
[root @ sora-localhost ~/data]  git merge testing						#åˆå¹¶åˆ†æ”¯
      Merge made by the 'recursive' strategy.
       testing-add | 0
       1 file changed, 0 insertions(+), 0 deletions(-)
       create mode 100644 testing-add
[root @ sora-localhost ~/data]  ll
      total 4
      -rw-r--r-- 1 root root  0 Apr 22 14:56 master-eee
      -rw-r--r-- 1 root root  0 Apr 22 14:59 testing-add
      
[root @ sora-localhost ~/data]  git branch -d testing 			# åˆå¹¶å®Œæˆååˆ é™¤åˆ†æ”¯å³å¯
			Deleted branch testing (was 3b3844f).
```

![image-20210422152518833](Gitç¬”è®°.assets/image-20210422152518833.png)



### å†²çªåˆå¹¶

```bash
[root @ sora-localhost ~/data]  git checkout master 
			Switched to branch 'master'
[root @ sora-localhost ~/data]  echo master >> aaa
[root @ sora-localhost ~/data]  git commit -am "modify aaa add master"


[root @ sora-localhost ~/data]  git checkout testing 
			Switched to branch 'testing'
[root @ sora-localhost ~/data]  echo testing >> aaa
[root @ sora-localhost ~/data]  git commit -am "modify aaa add testing"


[root @ sora-localhost ~/data]  git checkout master 
[root @ sora-localhost ~/data]  git merge testing 					# åˆå¹¶åˆ†æ”¯ aaaæ–‡ä»¶çš„å†…å®¹å‘ç”Ÿäº†å†²çª
      Auto-merging aaa
      CONFLICT (content): Merge conflict in aaa
      Automatic merge failed; fix conflicts and then commit the result.
[root @ sora-localhost ~/data]  cat aaa
      <<<<<<< HEAD
      master
      =======
      testing
      >>>>>>> testing



[root @ sora-localhost ~/data]  vim aaa     # å†²çªçš„æ–‡ä»¶è‡ªåŠ¨æ ‡è¯†åˆ°æ–‡ä»¶é‡Œ,æ‰‹åŠ¨æ›´æ”¹æ²–çªè¦ä¿ç•™çš„ä»£ç 
[root @ sora-localhost ~/data]  cat aaa
			master
[root @ sora-localhost ~/data]  git commit -am "resolve marge conflict"
			[master 99f8d5c] resolve marge conflict
```

![image-20210422170141404](Gitç¬”è®°.assets/image-20210422170141404.png)





## Gitæ ‡ç­¾

â€‹		æ ‡ç­¾ä¹Ÿæ˜¯æŒ‡å‘äº†ä¸€æ¬¡ `commit`æäº¤,æ˜¯ä¸€ä¸ªé‡Œç¨‹ç¢‘å¼çš„æ ‡ç­¾,å›æ»šæ‰“æ ‡ç­¾ç›´æ¥åŠ æ ‡ç­¾å·,ä¸éœ€è¦åŠ å”¯ä¸€å­—ç¬¦ä¸²ä¸å¥½è®°

```bash
[root @ sora-localhost ~/data]  git log --oneline --decorate
      99f8d5c (HEAD, master) resolve marge conflict
      ....
      4a8aa3a add aaa
[root @ sora-localhost ~/data]  git tag -a v1.0 4a8aa3a -m "Tag_add aaa"   
			# -aæŒ‡å®šæ ‡ç­¾å   å“ˆå¸Œå€¼ æŒ‡å®šæŸä¸€æ¬¡çš„æäº¤ä¸ºæ ‡ç­¾    -mæŒ‡å®šè¯´æ˜æ–‡å­—
[root @ sora-localhost ~/data]  git show v1.0 			# æŸ¥çœ‹v1.0çš„ä¿¡æ¯ 


[root @ sora-localhost ~/data]  git reset --hard v1.0     # å›æ»šæ•°æ®åˆ°v1.0çš„æäº¤
[root @ sora-localhost ~/data]  ll
      total 4
      -rw-r--r-- 1 root root 19 Apr 22 17:16 a
      -rw-r--r-- 1 root root  0 Apr 22 17:18 aaa


[root @ sora-localhost ~/data]  git reflog 
      4a8aa3a HEAD@{0}: reset: moving to v1.0
      99f8d5c HEAD@{1}: reset: moving to v2.0
      364af5a HEAD@{2}: reset: moving to v1.0
      99f8d5c HEAD@{3}: commit (merge): resolve marge conflict
[root @ sora-localhost ~/data]  git tag -a v2.0 99f8d5c -m "Tag_resolve marge conflict"

[root @ sora-localhost ~/data]  git reset --hard v2.0 
[root @ sora-localhost ~/data]  ll
			total 8
			
[root @ sora-localhost ~/data]  git tag    # æ˜¾ç¤ºå…¨éƒ¨æ ‡ç­¾
      v1.0
      v2.0
[root @ sora-localhost ~/data]  git tag -d v1.0			# åˆ é™¤æ ‡ç­¾
			Deleted tag 'v1.0' (was 5a77da4)
```







# GitHub

â€‹		**Github**é¡¾åæ€ä¹‰æ˜¯ä¸€ä¸ªGitç‰ˆæœ¬åº“çš„æ‰˜ç®¡æœåŠ¡,æ˜¯ç›®å‰å…¨çƒæœ€å¤§çš„è½¯ä»¶ä»“åº“,æ‹¥æœ‰ä¸Šç™¾ä¸‡çš„å¼€å‘è€…ç”¨æˆ·,ä¹Ÿæ˜¯è½¯ä»¶ å¼€å‘å’Œå¯»æ‰¾èµ„æºçš„æœ€ä½³é€”å¾„, Githubä¸ä»…å¯ä»¥æ‰˜ç®¡å„ç§Gitç‰ˆæœ¬ä»“åº“,è¿˜æ‹¥æœ‰äº†æ›´ç¾è§‚çš„Mlebç•Œé¢,æ‚¨çš„ä»£ç æ–‡ä»¶å¯ ä»¥è¢«ä»»ä½•äººå…‹éš†,ä½¿å¾—å¼€å‘è€…ä¸ºå¼€æºé¡¹è´¡çŒ®ä»£ç å˜å¾—æ›´åŠ å®¹æ˜“,å½“ç„¶ä¹Ÿå¯ä»¥ä»˜è´¹è´­ä¹°ç§æœ‰åº“,è¿™æ ·é«˜æ€§ä»·æ¯”çš„ç§æœ‰ åº“çœŸçš„æ˜¯å¸®åŠ©åˆ°äº†å¾ˆå¤šå›¢é˜Ÿå’Œä¼ä¸š 

1. æ³¨å†Œç”¨æˆ· è¯¾å‰æ³¨å†Œå¥½ç”¨æˆ· 

2. é…ç½®ssh-key 

   ````bash
   ssh-keygen -t rsa
   # æ— é™å›è½¦ ç”Ÿæˆç§˜é’¥
   cat .ssh/id_rsa.pub
   # è·å–å…¬é’¥ å°†å…¶å¤åˆ¶ 
   ````

   å¤åˆ¶åˆ°GitHubè®¾ç½®é‡Œçš„SSH keys

   ![image-20210422231359118](Gitç¬”è®°.assets/image-20210422231359118.png)

3. åˆ›å»ºé¡¹ç›® 

   â€‹	åˆ›å»ºä¸€ä¸ªæ–°çš„ä»“åº“ Create a new repository æ­¥éª¤çœç•¥

   

4. æ¨é€æ–°ä»£ç åˆ° github

   ![image-20210422230738585](Gitç¬”è®°.assets/image-20210422230738585.png)

   ```bash
   [root @ sora-localhost ~/data]  git remote add origin git@github.com:Apotosome/git_data.git
   [root @ sora-localhost ~/data]  git push -u origin master
       ...
       Compressing objects: 100% (22/22), done.
       Writing objects: 100% (31/31), 2.51 KiB | 0 bytes/s, done.
       Total 31 (delta 8), reused 0 (delta 0)
       remote: Resolving deltas: 100% (8/8), done.
       To git@github.com:Apotosome/git_data.git
        * [new branch]      master -> master
       Branch master set up to track remote branch master from origin.
   ```

5. å…‹éš†é¡¹ç›®åˆ°æœ¬åœ° 

<img src="Gitç¬”è®°.assets/image-20210423092936486.png" alt="image-20210423092936486" style="zoom:50%;" />

```bash
[root @ sora-localhost ~/dataTemp]  git clone git@github.com:Apotosome/git_data.git
      Cloning into 'git_data'...
      remote: Enumerating objects: 31, done.
      remote: Counting objects: 100% (31/31), done.
      remote: Compressing objects: 100% (14/14), done.
      remote: Total 31 (delta 8), reused 31 (delta 8), pack-reused 0
      Receiving objects: 100% (31/31), done.
      Resolving deltas: 100% (8/8), done.
[root @ sora-localhost ~/dataTemp]  ll git_data/
      total 8
      -rw-r--r-- 1 root root 19 Apr 23 09:32 a
      -rw-r--r-- 1 root root  7 Apr 23 09:32 aaa
      -rw-r--r-- 1 root root  0 Apr 23 09:32 bbb
      -rw-r--r-- 1 root root  0 Apr 23 09:32 ccc
      -rw-r--r-- 1 root root  0 Apr 23 09:32 master-eee
      -rw-r--r-- 1 root root  0 Apr 23 09:32 testing-add
```



# Gitlab

â€‹		Gitlabæ˜¯ä¸€ä¸ªç”¨äºä»“åº“ç®¡ç†ç³»ç»Ÿçš„å¼€æºé¡¹ç›®ã€‚ä½¿ç”¨Gitä½œä¸ºä»£ç ç®¡ç†å·¥å…·,å¹¶åœ¨æ­¤åŸºç¡€ä¸Šæ­å»ºèµ·æ¥çš„ebæœåŠ¡ã€‚å¯é€šè¿‡ebç•Œé¢è¿›è¡Œè®¿é—®å…¬å¼€çš„æˆ–è€…ç§äººé¡¹ç›®ã€‚å®ƒæ‹¥æœ‰ä¸ Githubç±»ä¼¼çš„åŠŸèƒ½,èƒ½å¤Ÿæµè§ˆæºä»£ç ,ç®¡ç†ç¼ºé™·å’Œæ³¨é‡Šã€‚å¯ ä»¥ç®¡ç†å›¢é˜Ÿå¯¹ä»“åº“çš„è®¿è¯,å®ƒéå¸¸æ˜“äºæµè§ˆæäº¤è¿‡çš„ç‰ˆæœ¬å¹¶æä¾›ä¸€ä¸ªæ–‡ä»¶å†å²åº“ã€‚å›¢é˜Ÿæˆå‘˜å¯ä»¥åˆ©ç”¨å†…ç½®çš„ç®€å•èŠå¤©ç¨‹åºè¿›è¡Œäº¤æµã€‚å®ƒè¿˜æä¾›ä¸€ä¸ªä»£ç ç‰‡æ®µæ”¶é›†åŠŸèƒ½å¯ä»¥è½»æ¾å®ç°ä»£ç å¤ç”¨ã€‚



## å®‰è£…é…ç½® 

1. ä¸‹è½½é“¾æ¥  é€‰æ‹©å¯¹åº”çš„ç³»ç»Ÿç±»å‹

   ```bash
   https://about.gitlab.com/install/
   ```

2. å®‰è£…å’Œé…ç½®å¿…è¦çš„ä¾èµ–é¡¹;ç¦ç”¨é˜²ç«å¢™,å…³ selinux

   ```bash
   sudo yum install -y curl policycoreutils-python openssh-server perl
   sudo systemctl enable sshd
   sudo systemctl start sshd
   
   sudo firewall-cmd --permanent --add-service=http
   sudo firewall-cmd --permanent --add-service=https
   sudo systemctl reload firewalld
   ```

3. ä¸‹è½½rpmå®‰è£…åŒ…  é€‰æ‹©å¯¹åº”çš„åŒ…å ç‚¹å‡»å³ä¾§çš„`wget`å¤åˆ¶  æˆ–è€…ä¸‹è½½åˆ°æœ¬åœ°é€šè¿‡sftpä¼ åˆ°è™šæ‹Ÿæœºä¸Š

   ```bash
   https://packages.gitlab.com/gitlab/gitlab-ce
   ```

4. rpmæŒ‡ä»¤å®‰è£…gitlabå®‰è£…åŒ…

   ```bash
   [root @ sora-localhost ~]  rpm -ivh gitlab-ce-13.11.0-ce.0.el7.x86_64.rpm
         ...
         Please configure a URL for your GitLab instance by setting `external_url`
         configuration in /etc/gitlab/gitlab.rb file.
         Then, you can start your GitLab instance by running the following command:
         sudo gitlab-ctl reconfigure
   ```

5. æ ¹æ®æç¤ºæ›´æ”¹urlåœ°å€

   ```bash
   [root @ sora-localhost ~]  vim /etc/gitlab/gitlab.rb 
         external_url 'http://10.200.106.4'   #ä¿®æ”¹ä¸ºæœ¬æœºipåœ°å€
   ```

6. æ ¹æ®æç¤ºæ›´æ”¹ è¿è¡ŒæœåŠ¡å‰ è¾“å…¥æŒ‡ä»¤ è¿›è¡Œé‡æ–°é…ç½®

   ```bash
   [root @ sora-localhost ~]  gitlab-ctl reconfigure
   ```

7. å¯åŠ¨GitlabåæŸ¥çœ‹çŠ¶æ€

   ```bash
   [root @ sora-localhost ~]  gitlab-ctl start
   [root @ sora-localhost ~]  gitlab-ctl status
   ```

8. è®¿é—®Gitlab

   æµè§ˆå™¨è¾“å…¥ä¸»æœºå·å³å¯è®¿é—®   `http://10.200.106.4/`

   é¦–æ¬¡è®¿é—®æ—¶ï¼Œæ‚¨å°†è¢«é‡å®šå‘åˆ°å¯†ç é‡ç½®å±å¹•ã€‚æä¾›åˆå§‹ç®¡ç†å‘˜å¸æˆ·çš„å¯†ç ï¼Œæ‚¨å°†è¢«é‡å®šå‘å›ç™»å½•å±å¹•ã€‚ä½¿ç”¨é»˜è®¤å¸æˆ·çš„ç”¨æˆ·å`root`ç™»å½•ã€‚

9. å®‰è£…æ±‰åŒ–è¡¥ä¸

    ```bash
   # 1ã€ä¸‹è½½æ±‰åŒ–è¡¥ä¸
   			git clone https://gitlab.com/xhang/gitlab.git 
   # 2ã€æŸ»çœ‹å…¨éƒ¨åˆ†æ”¯ç‰ˆæœ¬
   			git branch -a
   # 3ã€å¯¹æ¯”ç‰ˆæœ¬ã€ç”Ÿæˆè¡¥ä¸åŒ…
   			git diff remotes/origin/10-2-stable remotes/origin/10-2-stable-zh > ../10.2.2-zh diff 
   # 4ã€åœæ­¢æœåŠ¡å™¨ 
    			gitlab-ctl stop 
   # 5ã€æ‰“è¡¥ä¸
      		patch -d /opt/gitlab/embedded/service/gitlab-rails -p1 < /tmp/10.2.2-zh diff 
   # 6ã€å¯åŠ¨å’Œé‡æ–°é…ç½® 
   			gitlab-ctl start 
    			gitlab-ctl reconfigure
   ```


10. åŸºæœ¬é…ç½®

    - ä¿®æ”¹ç™»é™†ç•Œé¢æç¤ºæ–‡å­—å’ŒLogo

      1. è¿›å…¥ğŸ”§è®¾ç½®-Appearance

      2. Navigation bar å¯¼èˆªæ 

         Sign in/Sign up pages ç™»å½•ç•Œé¢

         Favicon ç½‘ç«™å›¾æ ‡

         ![image-20210424094610986](Gitç¬”è®°.assets/image-20210424094610986.png)

    

## é‡è¦ç›®å½•å’ŒæŒ‡ä»¤

- é‡è¦ç›®å½•

```bash
/opt/gitlab/								# git1abçš„ç¨‹åºå®‰è£…ç›®å½•
/var/opt/gitlab							# gitlabç›®å½•æ•°æ®ç›®å½•
/var/opt/gitlab/git-data		# å­˜æ”¾ä»“åº“æ•°æ®
```

- é‡è¦æŒ‡ä»¤

```bash
gitlab-ctl status						# æŸ¥çœ‹ç›®å‰git1abæ‰€æœ‰æœåŠ¡è¿ç»´çŠ¶æ€
gitlab-ctl start						# åœæ­¢git1abæœåŠ¡
gitlab-ctl stop							# åœæ­¢git1abæœåŠ¡
gitlab-ctl stop nginx				# å•ç‹¬åœæ­¢æŸä¸ªæœåŠ¡
gitlab-ctl tail							# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çš„æ—¥å¿—
```



## åŸºæœ¬æ“ä½œ

### åˆ›å»ºæ“ä½œ

`åˆ›å»ºç»„-åˆ›å»ºé¡¹ç›®-åˆ›å»ºæˆå‘˜`

1. **åˆ›å»ºç»„**

   è¿›å…¥ğŸ”§è®¾ç½®-overview-Dashboard-New group			 `test`

2. **åˆ›å»ºé¡¹ç›®**

   è¿›å…¥ğŸ”§è®¾ç½®-overview-Dashboard-New project	 	  `test`

   Create blank proiect   æ³¨æ„é€‰æ‹©å¯¹åº”çš„ç»„

   ![image-20210424103123025](Gitç¬”è®°.assets/image-20210424103123025.png)

3. é…ç½®SSH-keys 

   ````bash
   ssh-keygen -t rsa
   # æ— é™å›è½¦ ç”Ÿæˆå…¬é’¥
   cat .ssh/id_rsa.pub
   # è·å–ssh-key å°†å…¶å¤åˆ¶ 
   ````

   å¤åˆ¶åˆ°Preferences-SSH keys-Add key

4. Push an existing Git repository

   ```bash
   [root @ sora-localhost ~/data]  git remote rm origin 
   [root @ sora-localhost ~/data]  git remote add origin git@192.168.43.198:test/git_data.git
   [root @ sora-localhost ~/data]  git push -u origin master
   ```

5. å®‰å…¨æ€§è®¾ç½® å¼€å¯/å…³é—­æ³¨å†Œé¡µé¢

   è¿›å…¥ğŸ”§è®¾ç½®-Setting-Sign-up restrictions

   ![image-20210424134104371](Gitç¬”è®°.assets/image-20210424134104371.png)

6. **åˆ›å»ºç”¨æˆ·**

   è¿›å…¥ğŸ”§è®¾ç½®-overview-Users-New user å®Œæˆç”¨æˆ·çš„åˆ›å»º		`dev`

   Edit-è®¾ç½®password

7. å°†`dev`ç”¨æˆ·åŠ å…¥`test`ç»„

   è¿›å…¥`test`ç»„-Add user(s) to the group		æ³¨æ„æƒé™çš„è®¾å®š

   <img src="Gitç¬”è®°.assets/image-20210424135121270.png" alt="image-20210424135121270" style="zoom:67%;" />

   <img src="Gitç¬”è®°.assets/image-20210424135159299.png" alt="image-20210424135159299" style="zoom: 67%;" />

8. é…ç½®SSH Keysç­‰æ“ä½œåŒä¸Š
9. ä»è¿œç¨‹ä»“åº“cloneæ–¹æ³•å‚è§GitHub



### åˆ†æ”¯ä¿æŠ¤

``````bash
[root @ dev ~/git_data]  git add .
[root @ dev ~/git_data]  git commit -m "newfile t2.txt from dev"
[root @ dev ~/git_data]  git push -u origin master 
      remote: GitLab: You are not allowed to push code to protected branches on this project.To git@192.168.43.198:test/git_data.git
       ! [remote rejected] master -> master (pre-receive hook declined)
      error: failed to push some refs to 'git@192.168.43.198:test/git_data.git'
``````

æ¨é€è‡³masteræ—¶å‡ºç°é”™è¯¯ï¼šæ‚¨ä¸å¾—å°†ä»£ç æ¨é€åˆ°è¯¥é¡¹ç›®ä¸Šå—ä¿æŠ¤çš„åˆ†æ”¯ï¼

<img src="Gitç¬”è®°.assets/image-20210424151413932.png" alt="image-20210424151413932" style="zoom:67%;" />

- æ­£ç¡®åº”è¯¥æ¨é€åˆ°ä¸åŒçš„å·¥ä½œåˆ†æ”¯ä¸Š

```bash
[root @ dev ~/git_data]  git checkout -b dev
			Switched to a new branch 'dev'
[root @ dev ~/git_data]  git push -u origin dev
      remote: 
      To git@192.168.43.198:test/git_data.git
       * [new branch]      dev -> dev
      Branch dev set up to track remote branch dev from origin.
```

- æŸ¥çœ‹åˆ†æ”¯

  <img src="Gitç¬”è®°.assets/image-20210424152513547.png" alt="image-20210424152513547" style="zoom: 50%;" />



- è®¾ç½®åˆ†æ”¯ä¿æŠ¤

  è¿›å…¥é¡¹ç›®-Setting-Repository-Protected branches

  <img src="Gitç¬”è®°.assets/image-20210424153335677.png" alt="image-20210424153335677" style="zoom:67%;" />



### ä»£ç åˆå¹¶

#### devåˆ°master

```bash
[root @ dev ~/git_data]  echo "merge" >> merge.txt
[root @ dev ~/git_data]  git add .
[root @ dev ~/git_data]  git commit -m "newfile merge.txt from dev"
```

<img src="Gitç¬”è®°.assets/image-20210424154847559.png" alt="image-20210424154847559" style="zoom:50%;" />

- devå‘èµ·åˆå¹¶è¯·æ±‚
- è¿›å…¥`dev`åˆ†æ”¯ ç‚¹å‡»`Create merge request`  å¡«å†™åˆå¹¶è¯·æ±‚ä¿¡æ¯  

![image-20210424155254367](Gitç¬”è®°.assets/image-20210424155254367.png)

- ç¡®è®¤æ˜¯`dev`åˆ°`master`çš„è¯·æ±‚

- `root`è¿›è¡Œç¡®è®¤   è¿›å…¥é¡¹ç›®-Merge request  ç‚¹å‡»`Merge`ç¡®è®¤  

  æ³¨æ„ç¡®è®¤æ˜¯å¦è¦åˆ é™¤åˆ†æ”¯

  ![image-20210424160515960](Gitç¬”è®°.assets/image-20210424160515960.png)



#### masteråˆ°dev

```bash
[root @ sora-localhost ~/data]  echo "merge2" > merge2.txt
[root @ sora-localhost ~/data]  git add .
[root @ sora-localhost ~/data]  git commit -m "newfile merge2.txt from root"
[root @ sora-localhost ~/data]  git push -u origin master 
```

å¦‚æœæ­¤æ—¶å¯¹`dev`è¿›è¡Œæ¨é€æ˜¯ä¸å†²çªçš„ ä½†æ˜¯åˆ†æ”¯è„±ç¦»ä¸»å¹²æ˜¯ä¸è¢«å…è®¸çš„ï¼

``````bash
[root @ sora-localhost ~/data]  ll
      -rw-r--r-- 1 root root  0 Apr 24 16:12 merge2.txt
[root @ dev ~/git_data]  ll
      -rw-r--r-- 1 root root  0 Apr 24 16:32 merge3.txt
``````

==è§£å†³==ï¼š

1. å°†åˆ†æ”¯åˆ å» æ ¹æ®`master`é‡å»ºåˆ†æ”¯ ; æ— æ³•æ‰§è¡Œæ¨é€æŒ‡ä»¤ å› ä¸ºæœ¬åœ°ä¸è¿œç¨‹å†²çª 

```bash
[root @ dev ~/git_data]  git branch -d dev
[root @ sora-localhost ~/data]  ll
      -rw-r--r-- 1 root root  0 Apr 24 16:12 merge2.txt
[root @ dev ~/git_data]  git checkout -b dev  
[root @ dev ~/git_data]  git pull
			error: failed to push some refs to 'git@192.168.43.198:test/git_data.git'
```

2. ä»è¿œç¨‹ä»“åº“ä¸­æ‹‰å– ä¿è¯æœ¬åœ°ä»“åº“ä¸å…¶ä¿æŒä¸€è‡´

```bash
[root @ dev ~/git_data]  git pull origin dev
      Merge made by the 'recursive' strategy.
       merge3.txt | 0
[root @ dev ~/git_data]  ll
      -rw-r--r-- 1 root root  0 Apr 24 16:32 merge2.txt
      -rw-r--r-- 1 root root  0 Apr 24 16:43 merge3.txt
```

3. è¿œç¨‹ä»“åº“`master`æ²¡æœ‰ merge3.txt åˆ™éœ€è¦è¿›è¡Œä»£ç åˆå¹¶,å³ devåˆ°master

   è¿›å…¥é¡¹ç›®-Merge requests-`New merge request`

   ![image-20210424165651699](Gitç¬”è®°.assets/image-20210424165651699.png)

4. rootå®¡é˜…åˆå¹¶è¯·æ±‚å¹¶è¿›è¡Œç¡®è®¤

   æ­¤æ—¶masterå’Œdevç›¸åŒ  éœ€è¦åˆ æ‰dev ç„¶åé‡æ–°åˆ›å»ºåˆ†æ”¯ é˜²æ­¢å‡ºç°é”™è¯¯

   å‹¾é€‰ Delete source branch

5. `dev`æœ¬åœ°ä»“åº“è¿›è¡Œæ‹‰å–  æœ¬åœ°ä»“åº“å’Œè¿œç¨‹ä»“åº“ä¿æŒä¸€è‡´

```bash
[root @ sora-localhost ~/data]  git pull
			merge3.txt | 0
[root @ sora-localhost ~/data]  ll
      -rw-r--r-- 1 root root  0 Apr 24 16:12 merge2.txt
      -rw-r--r-- 1 root root  0 Apr 24 17:09 merge3.txt
```





# Jenkins

â€‹		Jenkinsæ˜¯ä¸€ä¸ªå¼€æºè½¯ä»¶é¡¹ç›®,æ˜¯åŸºäº]avaå¼€å‘çš„ä¸€ç§æŒç»­é›†æˆå·¥å…·,ç”¨äºç›‘æ§æŒç»­é‡å¤çš„å·¥ä½œ,æ—¨åœ¨æä¾›ä¸€ä¸ªå¼€æ”¾æ˜“ç”¨çš„è½¯ä»¶å¹³å°,ä½¿è½¯ä»¶çš„æŒç»­é›†æˆå˜æˆå¯èƒ½ã€‚



## å®‰è£…é…ç½®

1. å®‰è£…å‡†å¤‡
   è£…å¤‡ä¸¤å°æœåŠ¡å™¨ å…³se1inuxå’Œé˜²ç«å¢™   å†…å­˜2G   50G+ ç¡¬ç›˜ 

   

2. ä¸‹è½½Jenkinsé•œåƒå’ŒJDK åˆ°æœ¬åœ°é€šè¿‡sftpä¼ åˆ°è™šæ‹Ÿæœºä¸Š

```bash
Jenkins   https://mirrors.tuna.tsinghua.edu.cn/jenkins/redhat-stable/
JDK       https://www.oracle.com/java/technologies/javase-jdk16-downloads.html # CentOS7è‡ªå¸¦
```

3. rpmæŒ‡ä»¤è¿›è¡Œå®‰è£…

```bash
[root @ dev ~]  rpm -ivh jdk-8u271-linux-x64.rpm 
[root @ dev ~]  rpm -ivh jenkins-2.222.4-1.1.noarch.rpm  
```

4. å¯åŠ¨æœåŠ¡

```bash
[root @ dev ~]  vim  /etc/sysconfig/jenkins
			JENKINS_PORT="8081"    # é»˜è®¤ç«¯å£8080å¯èƒ½ä¼šæœ‰å†²çª ä¿®æ”¹ä¸º8081
[root @ dev ~]  systemctl start jenkins     
```

5. è®¿é—®Jenkins

   æµè§ˆå™¨è¾“å…¥ä¸»æœºå·:8081å³å¯è®¿é—®   `http://192.168.43.23:8081/`

   é¦–æ¬¡è®¿é—®æ—¶ï¼Œæ‚¨éœ€è¦è§£é” Jenkins æ ¹æ®æç¤ºä»æœ¬åœ°è·å–å¯†ç å³å¯ã€‚

   é¦–æ¬¡é…ç½®å¯ä»¥é€‰æ‹©adminï¼Œè¿›å…¥æ“ä½œç•Œé¢åå†è®¾ç½®é€‰é¡¹å¡ä¸­ä¿®æ”¹å¯†ç 





## é‡è¦ç›®å½•å’ŒæŒ‡ä»¤

- é‡è¦ç›®å½•

```bash
/usr/1ib/jenkins/					# jenkinså®‰è£…ç›®å½•,WARåŒ…ä¼šæ”¾åœ¨è¿™é‡Œ
/etc/sysconfig/jenkins  	#jenkinsé…ç½®æ–‡ä»¶,â€œç«¯å£â€,â€œENKINS_HOMEâ€ç­‰éƒ½å¯ä»¥åœ¨è¿™é‡Œé…ç½® 
/var/1ib/jenkins/					# é»˜è®¤çš„ JENKINS_HOME
		/var/lib/jenkins/workspace		# å·¥ä½œç©ºé—´ç›®å½•
		/var/lib/jenkins/users/admin_1039321490989125357/config.xml		# ç”¨æˆ·é…ç½®æ–‡ä»¶
/var/1og/jenkins/jenkins.1og			# Jenkinsæ—¥å¿—æ–‡ä»¶
```

- é‡è¦æŒ‡ä»¤

```bash
systemctl restart jenkins					# é‡å¯JenkinsæœåŠ¡
systemctl start jenkins						# å¯åŠ¨git1abæœåŠ¡
```



## åŸºæœ¬æ“ä½œ

### æ’ä»¶å®‰è£…

1. è·å–æ’ä»¶å®‰è£…åŒ…

2. æœ¬åœ°é€šè¿‡sftpä¼ åˆ°è™šæ‹Ÿæœºä¸Š  ä¿å­˜åˆ°ç›®å½•` /var/lib/jenkins/plugins`

3. tar xf æŒ‡ä»¤è¿›è¡Œè§£å‹   rmæŒ‡ä»¤ç§»åŠ¨åˆ°pluginsæ ¹ç›®å½•ä¸‹ 

4. restart Jenkins

5.  éœ€è¦æ·»åŠ çš„æ’ä»¶ï¼š

   â€‹	Gitlab Hook

   â€‹	Build Authorization Token Root

   â€‹	Publish Over SSH

   â€‹	Gitlab Authentication

   â€‹	Gitlab

   â€‹	Git Paramete

### åˆ›å»ºä»»åŠ¡

1. æ–°å»ºItem-è¾“å…¥ä»»åŠ¡å-é€‰æ‹©`Freestyle project`

2. General - å‹¾é€‰`Discard old builds`ä¸¢å¼ƒæ—§çš„æ„å»º     å¡«å…¥5~7å³å¯

   ![image-20210425213348877](æŒç»­é›†æˆ.assets/image-20210425213348877.png)

3. æ„å»º-`Execute shell`-é”®å…¥shellå‘½ä»¤ 

   ![image-20210425233243403](æŒç»­é›†æˆ.assets/image-20210425233243403.png)

4. ä¿å­˜æˆåŠŸåè¿›å…¥ä»»åŠ¡é¡µé¢-ç‚¹å‡»`Build Now`   

5. æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º

   ![image-20210425233524586](æŒç»­é›†æˆ.assets/image-20210425233524586.png)

   <img src="æŒç»­é›†æˆ.assets/image-20210425233723135.png" alt="image-20210425233723135" style="zoom: 67%;" />

6. æµ‹è¯•åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹çš„ä»»åŠ¡ 

   ```bash
   ## ä»»åŠ¡é¡µé¢-é…ç½®-æ„å»º
   # å‘½ä»¤
     pwd
     touch text.txt
     
   ## æ§åˆ¶å°è¾“å‡º
     + pwd
     /var/lib/jenkins/workspace/freestyle-job
     + touch text.txt
     Finished: SUCCESS
     
   ## ç»ˆç«¯
   [root @ dev /var/lib/jenkins/plugins]  cd /var/lib/jenkins/workspace/
   [root @ dev /var/lib/jenkins/workspace]  cd freestyle-job/
   [root @ dev /var/lib/jenkins/workspace/freestyle-job]  ll
   total 0
   -rw-r--r-- 1 jenkins jenkins 0 Apr 25 23:41 text.txt
   ```

   

## ä»£ç ä¸Šçº¿

### é…ç½®Jenkins

1. æ¨¡æ‹Ÿä»£ç æ‰‹åŠ¨ä¸Šçº¿çš„è¿‡ç¨‹

2. ä¾‹å¦‚ä»ç äº‘ä¸­è·å–é¡¹ç›®     clone-httpsæ–¹å¼

3. å‡†å¤‡webæœåŠ¡å™¨ï¼Œå¹¶å®‰è£…nginx WEBé¡µé¢

   ```bash
   [root @ web ~]  yum -y install nginx
   ```

4. rootæœåŠ¡å™¨ä¸Šå‡†å¤‡å¥½è¦ä¸Šä¼ çš„ä»£ç  è¿™é‡Œä»¥monitoré¡¹ç›®ä¸ºä¾‹ã€‚

5. `root`çš„èº«ä»½ç™»å½•gitlabï¼Œåˆ›å»ºé¡¹ç›®  æ³¨æ„ç»„è¦é€‰æ‹©`test`

   ``![image-20210426102118743](æŒç»­é›†æˆ.assets/image-20210426102118743.png)

6. ç°æœ‰æ–‡ä»¶å¤¹å·²ç»å­˜åœ¨ æ ¹æ®â€œæ¨é€ç°æœ‰æ–‡ä»¶å¤¹â€œæç¤ºè¾“å…¥ç›¸å…³æŒ‡ä»¤ å®Œæˆä¸Šä¼ åˆ°gitlabçš„å·¥ä½œ

```bash
[root @ sora-localhost ~/monitor]  ll
      total 1368
      ...
      drwxr-xr-x  5 501 games   128 Apr 26 10:14 assets
      -rwxr-xr-x  1 501 games 68654 Jun 28  2017 index.html


[root @ sora-localhost ~/monitor]  git init
[root @ sora-localhost ~/monitor]  git remote add origin git@192.168.43.198:test/monitor.git
[root @ sora-localhost ~/monitor]  git add .
[root @ sora-localhost ~/monitor]  git commit -m "Initial commit"
[root @ sora-localhost ~/monitor]  git push -u origin master
			Branch master set up to track remote branch master from origin.
```

7. å°†gitlabä¸Šçš„é¡¹ç›®æ‹‰å–åˆ°Jenkins

   å®Œæˆæ–°å»ºä»»åŠ¡-è¿›å…¥ä»»åŠ¡é¡µé¢-é…ç½®-æºç ç®¡ç†-é€‰ä¸­`Git`-å¡«å†™ç›¸å…³ä¿¡æ¯

<img src="æŒç»­é›†æˆ.assets/image-20210426103110773.png" alt="image-20210426103110773" style="zoom: 50%;" />

![image-20210427185550594](æŒç»­é›†æˆ.assets/image-20210427185550594.png)

#### å¸¸è§é”™è¯¯1

- è¿æ¥Gitlabæ—¶ï¼Œå‡ºç°`128é”™è¯¯`

  ![image-20210427175001292](æŒç»­é›†æˆ.assets/image-20210427175001292.png)

  **åŸå› åˆ†æ**

  1. å¯èƒ½æ˜¯ç”±äºgitå®¢æˆ·ç«¯ç‰ˆæœ¬è¿‡ä½é€ æˆçš„

  2. å¯èƒ½æ˜¯ç”¨æˆ·å‡­æ®ä¸å¯¹æˆ–è¯¥ç”¨æˆ·æ²¡æœ‰è¯¥é¡¹ç›®çš„è®¿é—®æƒé™

  **è§£å†³æ–¹æ³•**

  - å¯¹äºgitç‰ˆæœ¬é—®é¢˜çš„è§£å†³æ–¹æ³•

    1. å®‰è£…ä¾èµ–è½¯ä»¶

       ````bash
       [root @ jenkins ~]  yum install curl-devel expat-devel gettext-devel openssl-devel zlib-devel asciidoc
       [root @ jenkins ~]  yum install  gcc perl-ExtUtils-MakeMaker
       ````

    2. å¸è½½ç³»ç»Ÿè‡ªå¸¦çš„ä½ç‰ˆæœ¬git

       ```bash
       [root @ jenkins ~]  git --version		# æ£€æµ‹gitå®¢æˆ·ç«¯ç‰ˆæœ¬
             git version 1.8.3.1
       [root @ jenkins ~]  yum remove git
       ```

    3. å®‰è£…æ–°ç‰ˆæœ¬git

       Gitå®‰è£…åŒ…é•œåƒæºï¼šhttps://mirrors.edge.kernel.org/pub/software/scm/git/

       ```bash
       [root @ jenkins ~]  cd /usr/local/src/
       [root @ jenkins src]  wget https://www.kernel.org/pub/software/scm/git/git-2.30.0.tar.xz
       [root @ jenkins src] tar -xvf git-2.30.0.tar.xz
       [root @ jenkins src]  cd git-2.30.0/
       [root @ jenkins git-2.30.0]  make prefix=/usr/local/git all
       [root @ jenkins git-2.30.0]  make prefix=/usr/local/git install
       [root @ jenkins git-2.30.0]  echo "export PATH=$PATH:/usr/local/git/bin" >> /etc/profile
       [root @ jenkins git-2.30.0]  source /etc/profile
       [root @ jenkins git-2.30.0]  git --version
             git version 2.30.0
       ```

    

    - å¯¹äºå‡­è¯é—®é¢˜çš„è§£å†³æ–¹æ³•

      åˆ†æï¼šå¯†é’¥éªŒè¯å¤±è´¥ï¼Œå¯¼è‡´æ— æ³•ä»è¿œç¨‹ä»“åº“è¯»å–ã€‚è¯·ç¡®ä¿æ‚¨æœ‰æ­£ç¡®çš„è®¿é—®æƒé™å’Œgitä»“åº“çš„å­˜åœ¨ã€‚

      1. éƒ¨ç½²jenkinsçš„æœºå™¨åˆ›å»ºå’ŒæŸ¥çœ‹å¯†é’¥æ–‡ä»¶

         ```bash
         ssh-keygen -t rsa				# æ— é™å›è½¦ ç”Ÿæˆç§˜é’¥æ–‡ä»¶
         cat .ssh/id_rsa.pub			# è·å–å…¬é’¥ 
         cat .ssh/id_rsa					# è·å–ç§é’¥ 
         ```

         ==å…¬é’¥ç²˜åˆ°gitLabï¼Œç§é’¥ç²˜åˆ°jenkins==

      2. å°†`å…¬é’¥id_rsa.pub`é…ç½®åœ¨gitä»“åº“çš„æ‹¥æœ‰è€…çš„è´¦å·ä¸Š

         ![image-20210427183536108](æŒç»­é›†æˆ.assets/image-20210427183536108.png)

      3. ç®¡ç†Jenkins-Manage Credentials-å…¨å±€-æ·»åŠ å‡­è¯

         ![image-20210427184110338](æŒç»­é›†æˆ.assets/image-20210427184110338.png)

      4. å®Œæˆæ·»åŠ 

         ![image-20210427184506515](æŒç»­é›†æˆ.assets/image-20210427184506515.png)



8. ä¿å­˜æˆåŠŸåè¿›å…¥ä»»åŠ¡é¡µé¢-ç‚¹å‡»`Build Now`   

9. æ£€æŸ¥ä»£ç æ‹‰å–æƒ…å†µ

   ```bash
   [root @ jenkins ~]  cd /var/lib/jenkins/workspace/
   [root @ jenkins /var/lib/jenkins/workspace]  cd freestyle-job
   [root @ jenkins /var/lib/jenkins/workspace/freestyle-job]  ll
   ```



###ä»£ç è¿½è¸ª

####è„šæœ¬æè¿°

1. è¿›å…¥å·¥ä½œç›®å½•

2. æ‰“åŒ… å‹ç¼©åŒ…å‘½åéœ€è®°å½•å½“å‰æ—¶é—´ç²¾ç¡®åˆ°ç§’

   ``````bash
   [root @ jenkins ~]  date +%F-%H-%M-%S
   			2021-04-27-22-16-49
   ``````

3. å°†å‹ç¼©åŒ…æ‹·è´åˆ°NginxæœåŠ¡å™¨çš„ç«™ç‚¹æ ¹ç›®å½•

   â€‹	**scpæŒ‡ä»¤**ï¼šlinuxç³»ç»Ÿä¸‹åŸºäºsshç™»é™†è¿›è¡Œå®‰å…¨çš„è¿œç¨‹æ–‡ä»¶æ‹·è´å‘½ä»¤ï¼Œscpä¼ è¾“æ˜¯åŠ å¯†çš„ã€‚

   â€‹	ç«™ç‚¹æ ¹ç›®å½•ï¼š/usr/share/nginx/

4. è¿›å…¥ç«™ç‚¹æ ¹ç›®å½•ï¼Œè§£å‹æ‹·è´åçš„å‹ç¼©åŒ…  æ³¨æ„ä½¿ç”¨==ssh root@==

   â€‹		tar    -C é€‰é¡¹çš„ä½œç”¨æ˜¯ï¼šæŒ‡å®šéœ€è¦è§£å‹åˆ°çš„ç›®å½•ã€‚

5. è¿›è¡Œåˆæ­¥æµ‹è¯•

   1. æµ‹è¯•å‰éœ€è¦è®¾ç½®SSHæ— å¯†ç ç™»å½•

      â€‹		**ssh-copy-id** :å°†æœ¬æœºçš„å…¬é’¥å¤åˆ¶åˆ°è¿œç¨‹æœºå™¨çš„authorized_keysæ–‡ä»¶ä¸­

      â€‹				-i :æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯

      ```bash
      [root @ jenkins ~]  ssh-copy-id -i .ssh/id_rsa.pub 192.168.1.111
            Are you sure you want to continue connecting (yes/no)? yes
            root@192.168.1.111's password: 
            Now try logging into the machine, with:   "ssh '192.168.1.111'"
            and check to make sure that only the key(s) you wanted were added.
      
      [root @ jenkins ~]  ssh 192.168.1.111
      [root @ web ~]
      ```

   2. æ‰§è¡Œè„šæœ¬

      ```bash
      [root @ jenkins /server/scripts]  sh deploy.sh 			
      web-2021-04-27-23-30-04.tar.gz            100% 4552KB  14.9MB/s   00:00    			
      [root @ jenkins /server/scripts]  ssh 192.168.1.111
      [root @ web ~]  cd /usr/share/nginx/
      [root @ web /usr/share/nginx]  ll      
      drwxr-xr-x 3 root root     136 Apr 25 23:54 html      
      drwxr-xr-x 2 root root     143 Apr 25 23:55 modules      
      drwxr-xr-x 8 root root    4096 Apr 27 23:30 web-2021-04-27-23-30-04      
      -rw-r--r-- 1 root root 4661583 Apr 27 23:30 web-2021-04-27-23-30-04.tar.gz
      ```

6. åˆ é™¤å¤åˆ¶è¿‡æ¥çš„å®‰è£…åŒ…

7. ä¸ä½¿ç”¨Nginxç«™ç‚¹æ ¹ç›®å½•ä¸‹çš„htmlæ–‡ä»¶å¤¹ã€‚

   åˆ©ç”¨è½¯é“¾æ¥ï¼Œå°†è§£å‹åçš„æ–‡ä»¶å¤¹è¿æ¥æˆhtmlã€‚ä¿è¯åŸå§‹ä»£ç çš„å®Œæ•´æ€§

   å¦‚æœéœ€è¦å›æ»šï¼ŒåŒæ ·å¯ä»¥åˆ©ç”¨è½¯é“¾æ¥çš„æ–¹æ³•

   ```bash
   [root @ web /usr/share/nginx]  ll      
   total 4      
   lrwxrwxrwx 1 root root   23 Apr 27 23:44 html -> web-2021-04-27-23-44-55      
   drwxr-xr-x 2 root root  143 Apr 25 23:55 modules      
   drwxr-xr-x 8 root root 4096 Apr 27 23:44 web-2021-04-27-23-44-55
   ```

8. è®¿é—®NginxæœåŠ¡å™¨

   <img src="æŒç»­é›†æˆ.assets/image-20210428000009151.png" alt="image-20210428000009151" style="zoom: 67%;" />

####è„šæœ¬ä»£ç 

```shell
#!ä»£ç è¿½è¸ª
#!/bin/sh
CODE_DIR=/var/lib/jenkins/workspace/freestyle-job/
WEB_DIR=/usr/share/nginx/
IP=192.168.1.111
TIME=`date +%F-%H-%M-%S`


cd ${CODE_DIR} && tar -zcf /tmp/web-${TIME}.tar.gz ./*
scp /tmp/web-${TIME}.tar.gz  ${IP}:${WEB_DIR}

ssh root@${IP} "cd $WEB_DIR && mkdir web-${TIME}"
ssh root@${IP} "cd $WEB_DIR && tar xf web-${TIME}.tar.gz -C web-${TIME}"
ssh root@${IP} "cd $WEB_DIR && rm -rf web-${TIME}.tar.gz && rm -rf html "
ssh root@${IP} "cd $WEB_DIR && ln -s web-${TIME} html"
```

```shell
#!/bin/sh
cd /usr/share/nginx/
ls -d web-*
read -p "ä½ å¤åˆ¶ä½ éœ€è¦å›é¡¾çš„ç›®å½•ç‰ˆæœ¬:" var
rm -rf html
ln -s $var html
```



## è‡ªåŠ¨åŒ–éƒ¨ç½²

<img src="../../Desktop/æœªå‘½åç»˜å›¾2.png" alt="æœªå‘½åç»˜å›¾2" style="zoom:67%;" />

### æ‰‹åŠ¨å®ç°éƒ¨ç½²

å½“ä»“åº“ä»£ç å‘ç”Ÿæ”¹å˜ï¼Œç‚¹å‡»`Build Now`  -ç«‹å³ä¸Šä¼ åˆ°NginxæœåŠ¡å™¨

è¿›å…¥ä»»åŠ¡é¡µé¢-é…ç½®-æ„å»º-`Execute shell`-é”®å…¥shellå‘½ä»¤ 

![image-20210428000914672](æŒç»­é›†æˆ.assets/image-20210428000914672.png)

####æµ‹è¯•æ‰‹åŠ¨éƒ¨ç½²

```bash
[root @ sora-localhost ~]  cd monitor/
# ä¿®æ”¹ä»£ç å®Œæˆåè¿›è¡Œæ¨é€
[root @ sora-localhost ~/monitor]  git commit -m "ä¿®æ”¹index"
[root @ sora-localhost ~/monitor]  git push -u origin master 
```

è¿›å…¥GitlabæŸ¥çœ‹è¿œç¨‹ä»“åº“çš„ä»£ç æ˜¯å¦å·²ç»ä¿®æ”¹

Jenkinsè¿›å…¥ä»»åŠ¡é¡µé¢-ç‚¹å‡»`Build Now`   

![image-20210428145431751](æŒç»­é›†æˆ.assets/image-20210428145431751.png)

#### å¸¸è§é”™è¯¯2

- jenkinsåœ¨æ„å»ºçš„æ—¶å€™ï¼Œæ‰“å¼€æ§åˆ¶å°å¯ä»¥çœ‹åˆ°æ‰§è¡Œåˆ°shellè„šæœ¬çš„scpæŒ‡ä»¤éƒ¨åˆ†æ—¶ï¼Œæç¤ºæƒé™ä¸è¶³

  ![image-20210428145530926](æŒç»­é›†æˆ.assets/image-20210428145530926.png)

  åˆ†æï¼šæ‰§è¡Œè„šæœ¬çš„æ—¶å€™jenkinsä½¿ç”¨çš„ç”¨æˆ·æ²¡æœ‰å¯¹åº”æ–‡ä»¶çš„æƒé™ã€‚

1. æŸ¥çœ‹jenkinsä½¿ç”¨çš„ç”¨æˆ·

   `````bash
   [root @ jenkins ~]  vi /etc/sysconfig/jenkins 
   			JENKINS_USER="jenkins"
   `````

2. ä¿®æ”¹é»˜è®¤ç”¨æˆ·ä¸ºroot

   ![image-20210428145502255](æŒç»­é›†æˆ.assets/image-20210428145502255.png)

3. ä¿®æ”¹Jenkinsç›¸å…³æ–‡ä»¶å¤¹ç”¨æˆ·æƒé™ ç„¶åé‡å¯Jenkins

   ```bash
   [root @ jenkins ~]  chown -R root:root /var/lib/jenkins/
   [root @ jenkins ~]  chown -R root:root /var/cache/jenkins/
   [root @ jenkins ~]  chown -R root:root /var/log/jenkins/
   
   [root @ jenkins ~]  systemctl restart jenkins.service 
   ```

   

###å®ç°è‡ªåŠ¨éƒ¨ç½²

â€‹		å®ç°è‡ªåŠ¨éƒ¨ç½²ï¼Œå³Gitlabä¸Šçš„è¿œç¨‹ä»“åº“æœ‰æ–°çš„æ”¹åŠ¨å°±ç«‹å³é€šçŸ¥Jenkinsè¿›è¡Œæ„å»ºï¼Œå¹¶è‡ªåŠ¨æ¨é€åˆ°webç«™ç‚¹ç›®å½•ï¼Œè€Œæ— éœ€æ‰‹åŠ¨ç‚¹å‡»`Build Now`   

1. è¿›å…¥ä»»åŠ¡é¡µé¢-é…ç½®-æ„å»ºè§¦å‘å™¨-å‹¾é€‰`Build when a change is pushed to GitLab. GitLab webhook`

   ![image-20210428153829407](æŒç»­é›†æˆ.assets/image-20210428153829407.png)

   é»˜è®¤å³å¯-ç‚¹å‡»`é«˜çº§`-`Allowed branches` å¡«å…¥åªå…è®¸master

   ![image-20210428154346960](æŒç»­é›†æˆ.assets/image-20210428154346960.png) 

   â€‹	`Secret token`-ç‚¹å‡»`Generate`-å¤åˆ¶token  ç„¶åç‚¹å‡»ä¿å­˜å³å¯

   ![image-20210428154459538](æŒç»­é›†æˆ.assets/image-20210428154459538.png)



2. è¿›å…¥Gitlabé¡¹ç›®é¡µé¢-è®¾ç½®-`Webhooks`-ç²˜è´´åˆ°Secret token

   ç½‘å€å¡«çš„æ˜¯Jenkinsæä¾›çš„webhook URL  å…¶ä»–çš„é»˜è®¤å³å¯

   ![image-20210428155225864](æŒç»­é›†æˆ.assets/image-20210428155225864.png)

   ![image-20210428155517040](æŒç»­é›†æˆ.assets/image-20210428155517040.png)

   ç‚¹å‡»æ·»åŠ webhookå®Œæˆæ“ä½œ

   ![image-20210428160619159](æŒç»­é›†æˆ.assets/image-20210428160619159.png)

   å¯ä»¥ç‚¹å‡»`æµ‹è¯•`-`Push Event`  å¦‚æœæ˜¾ç¤ºæˆåŠŸå³å¯

   ![image-20210428160808286](æŒç»­é›†æˆ.assets/image-20210428160808286.png)

3. æµ‹è¯•æ˜¯å¦å®ç°è‡ªåŠ¨éƒ¨ç½²    æµ‹è¯•æ–¹å¼åŒæ‰‹åŠ¨å®ç°éƒ¨ç½²

<img src="æŒç»­é›†æˆ.assets/image-20210428161247653.png" alt="image-20210428161247653" style="zoom:67%;" />



####å¸¸è§é”™è¯¯3

Webhooksä¿å­˜æ—¶å‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š

![image-20210428155628763](æŒç»­é›†æˆ.assets/image-20210428155628763.png)

è§£å†³æ–¹æ³•ï¼š

è¿›å…¥ğŸ”§è®¾ç½®-ç½‘ç»œ-`outbound requests`å¤–å‘è¯·æ±‚-å‹¾é€‰`Allow requests to the local network from web hooks and services`

![image-20210428160224073](æŒç»­é›†æˆ.assets/image-20210428160224073.png)



####åé¦ˆåˆ°Gitlab

å®ç°Jenkinså®Œæˆæ„å»ºåçš„ä¿¡æ¯ä¼šåé¦ˆç»™Gitlab

- Jenkinså…¨å±€è®¾ç½®

  1. Jenkinsç³»ç»Ÿç®¡ç†-`Configure System`ç³»ç»Ÿè®¾ç½®-`GitLab`

  ![image-20210428165011251](æŒç»­é›†æˆ.assets/image-20210428165011251.png)

  2. è¿›å…¥gitlab-ç”¨æˆ·è®¾ç½®-ä¸ªäººè®¿é—®ä»¤ç‰Œ-å®Œæˆä¿¡æ¯å¡«å†™-ä¿å­˜å¤åˆ¶ä¸ªäººè®¿é—®ä»¤ç‰Œ

  ![image-20210428164247487](æŒç»­é›†æˆ.assets/image-20210428164247487.png)

  3. å›åˆ°Jenkinsè®¾ç½®é¡µç -ç‚¹å‡»æ·»åŠ    å¹¶ä¸”é€‰æ‹©æ·»åŠ å¥½çš„å‡­è¯

  ![image-20210428164630567](æŒç»­é›†æˆ.assets/image-20210428164630567.png)



- Jenkinsé¡¹ç›®è®¾ç½®

  è¿›å…¥é¡¹ç›®é¡µé¢-é…ç½®-`æ„å»ºåçš„æ“ä½œ`-é€‰æ‹©`Publish build status to Gitlab`

  ![image-20210428165842797](æŒç»­é›†æˆ.assets/image-20210428165842797.png)





# Maven

â€‹		**Maven**æ˜¯ä¸€ä¸ªé¡¹ç›®ç®¡ç†å’Œç»¼åˆå·¥å…·ã€‚ Mavenæä¾›ç»™å¼€å‘äººå‘˜æ„å»ºä¸€ä¸ªå®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸæ¡†æ¶ã€‚ å¼€å‘å›¢é˜Ÿå¯ä»¥è‡ªåŠ¨å®Œæˆè¯¥é¡¹ç›®çš„åŸºç¡€è®¾æ–½å»ºè®¾, Mavenä½¿ç”¨æ ‡å‡†çš„ç›®å½•ç»“æ„å’Œé»˜è®¤æ„å»ºç”Ÿå‘½å‘¨æœŸã€‚
â€‹		Apacheçš„å¼€æºé¡¹ç›®ä¸»è¦æœåŠ¡äºJAVAå¹³å°çš„æ„å»ºã€ä¾èµ–ç®¡ç†ã€é¡¹ç›®ç®¡ç†ã€‚
â€‹		**Project Object Model**,é¡¹ç›®å¯¹è±¡æ¨¡å‹ã€‚é€šè¿‡xmlæ ¼å¼ä¿å­˜çš„pom.xmlæ–‡ä»¶ã€‚è¯¥æ–‡ä»¶ç”¨äºç®¡ç†:æºä»£ç ã€é…ç½®æ–‡ä»¶ã€å¼€å‘è€…çš„ä¿¡æ¯å’Œè§’è‰²ã€é—®é¢˜è¿½è¸ªç³»ç»Ÿã€ç»„ç»‡ä¿¡æ¯ã€é¡¹ç›®æˆæƒã€é¡¹ç›®çš„urlã€é¡¹ç›®çš„ä¾èµ–å…³ç³»ç­‰ç­‰ã€‚è¯¥æ–‡ä»¶æ˜¯ç”±å¼€å‘ç»´æŠ¤,æˆ‘ä»¬è¿ç»´äººå‘˜å¯ä»¥ä¸ç”¨å»å…³å¿ƒ

## å®‰è£…é…ç½® 

1. ä¸‹è½½Mavenå®‰è£…åŒ…

   ```bash
   https://mirrors.tuna.tsinghua.edu.cn/apache/maven/
   ```

2. å®‰è£…Maven

   ```bash
   [root @ maven ~]  tar xvf apache-maven-3.8.1-bin.tar.gz 
   [root @ maven ~]  mv apache-maven-3.8.1  /usr/local/
   [root @ maven ~]  cd /usr/local/
   [root @ maven /usr/local]  ln -s apache-maven-3.8.1/ maven		# è½¯é“¾æ¥æˆmaven
   [root @ maven /usr/local]  ll
         lrwxrwxrwx  1 root root 19 Apr 29 00:20 maven -> apache-maven-3.8.1/
   ```

3. é…ç½®ç¯å¢ƒå˜é‡

   ```bash
   [root @ maven ~]  vim /etc/profile
         export PATH=/usr/local/maven/bin:$PATH
   [root @ maven ~]  source /etc/profile
   ```



## é‡è¦ç›®å½•å’ŒæŒ‡ä»¤

- é‡è¦ç›®å½•

```bash
/usr/local/maven/bin/m2.conf			# é…ç½®ä¸‹è½½æ¥çš„ä¾èµ–åŒ…çš„å­˜æ”¾è·¯å¾„
```

- é‡è¦æŒ‡ä»¤

```bash
mvn -v				# æŸ¥çœ‹ç‰ˆæœ¬å·
validate			# (éªŒè¯):éªŒè¯é¡¹ç›®æ­£ç¡®,å¹¶ä¸”æ‰€æœ‰å¿…è¦ä¿¡æ¯å¯ç”¨ã€‚ 
compile				# (ç¼–è¯‘):ç¼–è¯‘é¡¹ç›®æºç 
test					# (æµ‹è¯•):ä½¿ç”¨åˆé€‚çš„å•å…ƒæ¸¬è¯•æ¡†æ¶æµ‹è¯•ç¼–è¯‘åçš„æºç 
package				# (æ‰“åŒ…):æºç ç¼–è¯‘ä¹‹å,ä½¿ç”¨åˆé€‚çš„æ ¼å¼(ä¾‹å¦‚JARæ ¼å¼)å¯¹ç¼–è¯‘åçš„æºç è¿›è¡Œæ‰“åŒ… 
integration-test			# (é›†æˆæµ‹è¯•):å¦‚æœæœ‰éœ€è¦,æŠŠåŒ…å¤„ç†å¹¶éƒ¨ç½²åˆ°å¯ä»¥è¿è¡Œé›†æˆæµ‹è¯•çš„ç¯å¢ƒä¸­å»ã€‚ 
verify				# (éªŒè¯):è¿›è¡Œå„ç§æµ‹è¯•æ¥éªŒè¯åŒ…æ˜¯å¦æœ‰æ•ˆå¹¶ä¸”ç¬¦åˆè´¨é‡æ ‡å‡†ã€‚
insta11				# (å®‰è£…):æŠŠåŒ…å®‰è£…åˆ°æœ¬åœ°ä»“åº“,ä½¿è¯¥åŒ…å¯ä»¥ä½œä¸ºå…¶ä»–æœ¬åœ°é¡¹ç›®çš„ä¾èµ–ã€‚
deploy				# (éƒ¨ç½²):åœ¨é›†æˆæˆ–å‘å¸ƒç¯å¢ƒä¸­å®Œæˆ,å°†æœ€ç»ˆè½¯ä»¶åŒ…å¤åˆ¶åˆ°è¿œç¨‹å­˜å‚¨åº“,ä»¥ä¸å…¶ä»–å¼€å‘äººå‘˜å’Œé¡¹ç›®å…±äº«ã€‚
mvn clean			# (æ¸…é™¤):æ¸…é™¤ä¸Šæ¬¡ç¼–è¯‘çš„ç»“æœ 
mvn package		# ä¼šå»mavençš„ä¸­å¤®ä»“åº“å»ä¸‹è½½éœ€è¦çš„ä¾èµ–åŒ…å’Œæ’ä»¶åˆ°m2ç›®å½•ä¸‹
```



##ç§æœNexus

### å®‰è£…nexus

1. å¤‡ä»½Mavenå…¨å±€é…ç½®æ–‡ä»¶

   ```bash
   [root @ maven /usr/local/maven]  cd /usr/local/maven/conf/
   [root @ maven /usr/local/maven/conf]  cp settings.xml{,.bak}		# å¤‡ä»½å…¨å±€é…ç½®æ–‡ä»¶
   [root @ maven /usr/local/maven/conf]  ll
         -rw-r--r-- 1 root root 10741 Nov  7  2019 settings.xml
         -rw-r--r-- 1 root root 10741 Apr 29 00:45 settings.xml.bak
   ```

2. ä½¿ç”¨é˜¿é‡Œäº‘äº‘æ•ˆMavenè¿›è¡Œé…ç½®

   æ‰“å¼€ maven çš„é…ç½®æ–‡ä»¶ï¼Œåœ¨<mirrors></mirrors>æ ‡ç­¾ä¸­æ·»åŠ  mirror å­èŠ‚ç‚¹

   ```xml
   <mirror>
     <id>aliyunmaven</id>
     <mirrorOf>*</mirrorOf>
     <name>é˜¿é‡Œäº‘å…¬å…±ä»“åº“</name>
     <url>https://maven.aliyun.com/repository/public</url>
   </mirror>
   ```

3. å®‰è£…nexus

   - é…ç½®ä»“åº“ä¸¤ä¸ªé€‰é¡¹
     1. é¡¹ç›®ä¸‹çš„pom.xmlé…ç½®ã€åªç”Ÿæ•ˆå½“å‰çš„é¡¹ç›® 

     2. åœ¨mavené…ç½®å…¨å±€æ‰€æœ‰é¡¹ç›®ç”Ÿæ•ˆ

   - å‡†å¤‡å¥½nexusæœåŠ¡å™¨

   - ä¸‹è½½å¹¶ä¸Šä¼ JDKå’Œnexuså®‰è£…åŒ…

     ```bash
     JDK			http://www.sousou88.com/spec/version8.html#jdk8u271
     nexus		https://pan.baidu.com/s/178Ie7A2oU3eBPZO2bkqz_g  å¯†ç : rda7
     ```

   - å®‰è£…JDKå’Œnexus

     ```bash
     [root @ nexus ~]  rpm -ivh jdk-8u271-linux-x64.rpm 
     
     [root @ nexus ~]  tar -xvf nexus-3.19.1-01-unix.tar.gz
     [root @ nexus ~]  mv nexus-3.19.1-01/ /usr/local/
     [root @ nexus ~]  cd /usr/local/
     [root @ nexus /usr/local]  ln -s nexus-3.19.1-01/ nexus
     [root @ nexus /usr/local]  ll
     			lrwxrwxrwx  1 root root  16 Apr 29 16:28 nexus -> nexus-3.19.1-01/
     ```

   - å¯åŠ¨nexus

     ```bash
     [root @ nexus /usr/local]  /usr/local/nexus/bin/nexus start
           Starting nexus
     [root @ nexus /usr/local]  /usr/local/nexus/bin/nexus status
     			nexus is running.
     ```

4. è®¿é—®Jenkins

   æµè§ˆå™¨è¾“å…¥ä¸»æœºå·:8081å³å¯è®¿é—®   `http://192.168.43.23:8081/`

   ç‚¹å‡»å³ä¸Šè§’çš„`Sign in` ï¼Œè¾“å…¥ç”¨æˆ·åå’Œå¯†ç 

   æ ¹æ®æç¤ºè¿›è¡Œåˆå§‹è®¾ç½®

   

###é‡è¦ç›®å½•å’ŒæŒ‡ä»¤

- é‡è¦ç›®å½•

```bash
/usr/local/sonatype-work/nexus3/admin.password					# é»˜è®¤ç™»é™†å¯†ç 
```

- é‡è¦æŒ‡ä»¤

```bash
/usr/local/nexus/bin/nexus  start						# å¯åŠ¨nexusæœåŠ¡
/usr/local/nexus/bin/nexus  status					# nexusçŠ¶æ€
```



### åŸºæœ¬æ“ä½œ

#### é…ç½®nexus

- é…ç½®ä»£ç†

  è¿›å…¥ğŸ”§è®¾ç½®-`Repositiories`-ç‚¹å‡»`maven-central`

  è¿›å…¥proxyè®¾ç½®ï¼Œä¿®æ”¹remote storageä¸ºé˜¿é‡Œäº‘å…¬å…±ä»“åº“

  ![image-20210429175018662](æŒç»­é›†æˆ.assets/image-20210429175018662.png)

  

- é…ç½®Maven

  1. è¿›å…¥é…ç½®æ–‡ä»¶

     ```bash
     [root @ maven ~]  cd /usr/local/maven/conf/
     [root @ maven /usr/local/maven/conf]  cp settings.xml settings.xml.aliyun		# å¤‡ä»½æ–‡ä»¶
     [root @ maven /usr/local/maven/conf]  vim settings.xml
     # å°†åŸå…ˆçš„<mirrors>æ ‡ç­¾ä¸‹é˜¿é‡Œäº‘å…¬å…±ä»“åº“ä¿¡æ¯æ³¨é‡Šæ‰
     ```

  2. ä¿®æ”¹ Mavençš„é…ç½®æ–‡ä»¶,æ•´åˆ Nexus

     - æ‰¾åˆ°<servers>æ ‡ç­¾,æ·»åŠ  Nexusé»˜è®¤è®¤è¯ä¿¡æ¯

       ```xml
           <server>
             <id>my-nexus-releases</id> 
             <username>admin</username> 
             <password>admin123</password> 
           </server> 
           <server>
             <id>my-nexus-snapshot</id>
             <username>admin</username>
             <password>admin123</password>
           </server>
       ```

     - æ‰¾åˆ°<mirrors>æ ‡ç­¾,æ·»åŠ é•œåƒ,urlä¸ºnexusç§æœåœ°å€

       ![image-20210429175459609](æŒç»­é›†æˆ.assets/image-20210429175459609.png)

       ```xml
           <mirror>
             <id>nexus</id>
             <mirrorOf>*</mirrorOf>
             <url>http://192.168.1.110:8081/repository/maven-public/</url>
           </mirror>
       ```

     - æ‰¾åˆ°<profiles>æ ‡ç­¾,æ·»åŠ åˆåº“ä¿¡æ¯

       ```xml
           <profile>
             <id>nexus</id>
             <repositories>
                 <repository>
                   <id>central</id>
                   <url>http://192.168.1.110:8081/repository/maven-public/</url>
                   <releases><enabled>true</enabled></releases> 
                   <snapshots><enabled>true</enabled></snapshots>
                 </repository>
             </repositories>
             <pluginRepositories>
                 <pluginRepository>
                   <id>central</id>
                   <url>http://192.168.1.110:8081/repository/maven-public/</url>
                   <releases><enabled>true</enabled></releases> 
                   <snapshots><enabled>true</enabled></snapshots>
                 </pluginRepository>
             </pluginRepositories>
           </profile>
       ```

     - æ¿€æ´»ä»“åº“

       ```xml
           <activeProfiles>
               <activeProfile>nexus</activeProfile>
           </activeProfiles>
       ```

       

## ä»£ç ä¸Šçº¿

### ä»£ç ä¸Šä¼ 

1. rootæœåŠ¡å™¨ä¸Šå‡†å¤‡è¦ä¸Šçº¿çš„é¡¹ç›® å¹¶æ¨é€è‡³gitlab

2. Jenkinsæ–°å»ºItem-è¾“å…¥ä»»åŠ¡å-é€‰æ‹©`æ„å»ºä¸€ä¸ªMavené¡¹ç›®`

3. é¡¹ç›®åŸºæœ¬è®¾ç½®å‚è€ƒå‰æ–‡

4. `build`é¡¹è®¾ç½®    `Goals and options`å¡«å…¥   **clean package**

5. Jenkinsé…ç½®Maven

   ç®¡ç†Jenkins-`Global Tool Confiquration`-Maven-ç‚¹å‡»`å®‰è£…Maven`

   æ³¨æ„ï¼šå–æ¶ˆå‹¾é€‰Install automatically

   ![image-20210429231554564](æŒç»­é›†æˆ.assets/image-20210429231554564.png)

6. è¿”å›é¡¹ç›®é…ç½®ä¸­ï¼ŒæŸ¥çœ‹buildä¸å†æŠ¥é”™

   ![image-20210429231659979](æŒç»­é›†æˆ.assets/image-20210429231659979.png)

7. ä¿å­˜æˆåŠŸåè¿›å…¥ä»»åŠ¡é¡µé¢-ç‚¹å‡»`Build Now`   



###éƒ¨ç½²

- å®‰è£…JDKå’ŒTomcat

  1. ä¸‹è½½å¹¶å®‰è£…

     ```bash
     # Tomcat		https://mirrors.cnnic.cn/apache/tomcat/
     [root @ web ~]  rpm -ivh jdk-8u271-linux-x64.rpm 
     
     [root @ web ~]  mkdir /application
     [root @ web ~]  tar xf apache-tomcat-9.0.45-src.tar.gz -C /application/
     [root @ web ~]  cd /application/
     [root @ web /application]  ln -s apache-tomcat-9.0.45-src/ tomcat
     ```

  2. å¯åŠ¨åŠ é€Ÿ

     1. ä¿®æ”¹JDKä¸­çš„æ–‡ä»¶  

        ```bash
        [root @ web ~]  vim /usr/java/jdk1.8.0_271-amd64/jre/lib/security/java.security 
              117   securerandom.source=file:/dev/urandom
        ```

     2. å¯åŠ¨Tomcat

        å¦‚æœå‡ºç°æƒé™é”™è¯¯ç­‰ï¼Œå‚è€ƒhttps://blog.csdn.net/bingxuesiyang/article/details/88381323

        ```bash
        [root @ web ~]  /application/tomcat/bin/startup.sh 
              Tomcat started.
        ```

        æµè§ˆå™¨è¾“å…¥ä¸»æœºå·:8080å³å¯è®¿é—®   `http://192.168.1.111:8080/`

- å®‰è£…é…ç½®mysqlæ•°æ®åº“

  1. å®‰è£…é…ç½®æ•°æ®åº“

     åœ¨ Centos7ä¸­å®‰è£… MYSQL8		https://www.cnblogs.com/willick/p/install-mysql-8-centos-7.html

     ```bash
     [root @ web ~]  mysql -uroot -proot -e "create database tduck"
     [root @ web ~]  mysql -uroot -proot -e "show databases"
           +--------------------+
           | Database           |
           +--------------------+
           | information_schema |
           | mysql              |
           | performance_schema |
           | tduck              |
           | test               |
           +--------------------+
     ```

  2. æ‰§è¡Œsqlæ–‡ä»¶

     ```bash
     [root @ maven ~]   cd /var/lib/jenkins/workspace/tduck-platform-job/doc/
     [root @ maven doc]  ll
           -rwxr-xr-x 1 root root 18569 Apr 30 11:07 tduck.sql
     [root @ maven doc]  scp  tduck.sql  192.168.1.111:/tmp/      
     
     [root @ web ~]  cd /tmp/
     [root @ web /tmp]  ll
     			-rwxr-xr-x  1 root root 18569 Apr 30 12:58 tduck.sql
     			
     [root @ web ~]  mysql -uroot -proot tduck < tduck.sql 
     [root @ web ~]  mysql -uroot -proot -e "use tduck;show tables"
           mysql: [Warning] Using a password on the command line interface can be insecure.
           +------------------------------+
           | Tables_in_tduck              |
           +------------------------------+
           | ac_user                      |
           | ac_user_authorize            |
           | pr_project_template          |
           | pr_project_template_category |
           | pr_project_template_item     |
           | pr_project_theme             |
           | pr_user_project              |
           | pr_user_project_item         |
           | pr_user_project_result       |
           | pr_user_project_setting      |
           | pr_user_project_theme        |
           | wx_mp_user                   |
           +------------------------------+
     ```

- è¿œç¨‹æ¨é€waråŒ…

  è¿›å…¥Jenkins-é…ç½®-`Post Steps`-æ·»åŠ `Execute shell`

  ```shell
  ssh root@192.168.1.111  "mv /application/tomcat/webapps/*   /opt"			# å¤‡ä»½
  scp /var/lib/jenkins/workspace/maven-1ob/jeesns-web/target/jeesns-web.war  192.168.1.111:/application/tomcat/webapps/ROOT.war
  ```

  ![image-20210430152837557](æŒç»­é›†æˆ.assets/image-20210430152837557.png)

- å‰åç«¯åˆ†ç¦»é¡¹ç›®

  1. CentOS7é…ç½®node.jsï¼š	

     â€‹	https://www.cnblogs.com/sanduzxcvbnm/p/13495529.html

  2. Jenkinså‰åç«¯å‰åç«¯åˆ†ç¦»	

     â€‹	https://blog.csdn.net/qq_34775355/article/details/112209634

     â€‹	https://blog.csdn.net/lvye1221/article/details/106229536

  3. tduckéƒ¨ç½²æ–‡æ¡£	

     https://gitee.com/TDuckApp/tduck-platform/wikis/%E6%9C%AC%E5%9C%B0%E8%BF%90%E8%A1%8C?sort_id=3681729

     

  4. é…ç½®Nginx

     ```bash
     [root @ web /etc/nginx]  vim nginx.conf
     ```

     ![image-20210430164345296](æŒç»­é›†æˆ.assets/image-20210430164345296.png)

5. å®Œæˆéƒ¨ç½²

   ![image-20210430164624697](æŒç»­é›†æˆ.assets/image-20210430164624697.png)



# Jenkins Pipeline



## åŸºæœ¬æ¦‚å¿µ

###**Câ… /CD  **

1. æŒç»­é›†æˆ(**c**ontinuous **i**ntegration)æ˜¯ä¸€ç§è½¯ä»¶å¼€å‘å®è·µ,å³å›¢é˜Ÿå¼€å‘æˆå‘˜ç»å¸¸é›†æˆå®ƒä»¬çš„å·¥ä½œ,é€šè¿‡æ¯ä¸ªæˆå‘˜æ¯å¤©è‡³å°‘é›†æˆä¸€æ¬¡,ä¹Ÿå°±æ„å‘³ç€æ¯å¤©å¯èƒ½ä¼šå‘ç”Ÿå¤šæ¬¡é›†æˆã€‚æ¯æ¬¡é›†æˆéƒ½é€šè¿‡è‡ªåŠ¨åŒ–çš„æ„å»º(åŒ…æ‹¬ç¼–è¯‘,å‘å¸ƒ,è‡ªåŠ¨åŒ–æµ‹è¯•)æ¥éªŒè¯,ä»è€Œå°½æ—©åœ°å‘ç°é›†æˆé”™è¯¯ã€‚

   æ¯”å¦‚(ä½ å®¶è£…ä¿®å¨æˆ¿,å…¶ä¸­ä¸€é¡¹æ˜¯é“ºåœ°ç –,è¾¹è§’åœ°ç –è¦åˆ‡å‰²å¤§å°ã€‚å¦‚æœä¸€æ¬¡å…¨åˆ‡å‰²å®Œå†é“ºä¸Šå»,å‘ç°å°ºå¯¸æœ‰è¯¯çš„è¯ æµªè´¹å’Œè¿”å·¥æ—¶é—´å°±å¤§äº†,ä¸å¦‚åˆ‡ä¸€å—é“ºä¸€å—ã€‚è¿™å°±æ˜¯æŒç»­é›†æˆã€‚

2. æŒç»­éƒ¨ç½²(**c**ontinuous **d**eployment)æ˜¯é€šè¿‡è‡ªåŠ¨åŒ–çš„æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²å¾ªç¯æ¥å¿«é€Ÿäº¤ä»˜é«˜è´¨é‡çš„äº§å“ã€‚æŸç§ç¨‹åº¦ä¸Šä»£è¡¨äº†ä¸€ä¸ªå¼€å‘å›¢é˜Ÿå·¥ç¨‹åŒ–çš„ç¨‹åº¦,æ¯•ç«Ÿå¿«é€Ÿè¿è½¬çš„äº’è”ç½‘å…¬å¸äººåŠ›æˆæœ¬ä¼šé«˜äºæœºå™¨,æŠ•èµ„æœºå™¨ä¼˜åŒ–å¼€å‘æµç¨‹åŒ– ç›¸å¯¹ä¹Ÿæé«˜äº†äººçš„æ•ˆç‡

   æ¯”å¦‚(è£…ä¿®å¨æˆ¿æœ‰å¾ˆå¤šéƒ¨åˆ†,æ¯ä¸ªéƒ¨åˆ†éƒ½æœ‰æ£€æµ‹æ‰‹æ®µ,å¦‚åœ°ç –é“ºå®Œäº†è¦æµ‹è¯•æ¼æ°´ä¸å¦,çº¿è·¯é“ºå®Œäº†è¦é€šç”µæµ‹è¯•ç”µè·¯é€šé¡º,æ°´ç®¡è£…å¥½äº†ä¹Ÿè¦æµ‹è¯•å†·æ°´çƒ­æ°´ã€‚å¦‚æœå…¨éƒ¨è£…å®Œäº†å†æµ‹æ¸¬,å‡ºç°é—®é¢˜å¯èƒ½ä¼šäº’ç›¸å½±å“,æ¯”å¦‚ç”µè·¯ä¸è¡Œå¯èƒ½è¦æŠŠåœ°ç –ç»™æŒ–å¼€ã€‚é‚£ä¹ˆæ¯å®Œæˆä¸€éƒ¨åˆ†å°±æµ‹è¯•,è¿™æ˜¯æŒç»­éƒ¨ç½²ã€‚)

3. æŒç»­äº¤ä»˜(**c**ontinuous **d**elivery)é¢‘ç¹åœ°å°†è½¯ä»¶çš„æ–°ç‰ˆæœ¬,äº¤ä»˜ç»™è´¨é‡å›¢é˜Ÿæˆ–è€…ç”¨æˆ·,ä»¥ä¾›è¯„å®¡å°½æ—©å‘ç°ç”Ÿäº§ç¯å¢ƒä¸­å­˜åœ¨çš„é—®é¢˜;å¦‚æœè¯„å®¡é€šè¿‡,ä»£ç å°±è¿›å…¥ç”Ÿäº§é˜¶æ®µ

   æ¯”å¦‚(å…¨éƒ¨è£…ä¿®å®Œäº†,ä½ å»éªŒæ”¶,å‘ç°åœ°ç –é¢œè‰²ä¸åˆæ„,æ°´æ± å¤ªå°,ç¶å°ä½ç½®ä¸å¯¹,è¿”å·¥å—?æ‰€ä»¥ä¸å¦‚æ²¡å®Œæˆä¸€éƒ¨åˆ†,ä½ å°±å»ç”¨ä¸€ä¸‹è¯•ç”¨éªŒæ”¶,è¿™å°±æ˜¯æŒç»­äº¤ä»˜)

4. æ•æ·æ€æƒ³ä¸­æå‡ºçš„è¿™ä¸‰ä¸ªè§‚ç‚¹,è¿˜å¼ºè°ƒä¸€ä»¶äº‹:é€šè¿‡æŠ€æœ¯æ‰‹æ®µè‡ªåŠ¨åŒ–è¿™ä¸‰ä¸ªå·¥ä½œã€‚åŠ å¿«äº¤ä»˜é€Ÿåº¦

   

###**Pipeline**

1. ä»€ä¹ˆæ˜¯pipeline

   Jenkins2.0çš„ç²¾é«“æ˜¯ Pipeline as Code,æ˜¯å¸®åŠ©Jenkinså®ç°CIåˆ°CDè½¬å˜çš„é‡è¦è§’è‰²ã€‚ä»€ä¹ˆæ˜¯ Pipeline,ç®€å• æ¥è¯´,å°±æ˜¯ä¸€å¥—è¿è¡Œäº] elkinsä¸Šçš„å·¥ä½œæµæ¡†æ¶,å°†åŸæœ¬ç‹¬ç«‹è¿è¡Œäºå•ä¸ªæˆ–è€…å¤šä¸ªèŠ‚ç‚¹çš„ä»»åŠ¡è¿æ¥èµ·æ¥,å®ç°å•ä¸ªä»»åŠ¡éš¾ä»¥å®Œæˆçš„å¤æ‚å‘å¸ƒæµç¨‹ã€‚ Pipelineçš„å®ç°æ–¹å¼æ˜¯ä¸€å¥— Groovy DSL,ä»»ä½•å‘å¸ƒæµç¨‹éƒ½å¯ä»¥è¡¨è¿°ä¸ºä¸€æ®µ Groovy è„šæœ¬,å¹¶ä¸”Jenkinsæ”¯æŒä»ä»£ç åº“ç›´æ¥è¯»å–è„šæœ¬,ä»è€Œå®ç°äº† Pipeline as Codeçš„ç†å¿µ

2. **Pipelineæ¦‚å¿µ**

   Pipelineæ˜¯ä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„CDæµæ°´çº¿æ¨¡å¼ã€‚ Pipelineä»£ç å®šä¹‰äº†é€šå¸¸åŒ…å«æ„å»ºã€æµ‹è¯•å’Œå‘å¸ƒæ­¥éª¤çš„å®Œæ•´çš„æ„å»ºè¿‡ç¨‹

   - Node
     nodeæ˜¯ä¸€ä¸ª**æœºå™¨**,å®ƒæ˜¯Jenkinsç¯å¢ƒçš„ä¸€éƒ¨åˆ†,å¹¶ä¸”èƒ½å¤Ÿæ‰§è¡Œ Pipelineã€‚åŒæ—¶,nodeä»£ç å—ä¹Ÿæ˜¯è„šæœ¬å¼Pipelineè¯­æ³•çš„å…³é”®ç‰¹æ€§ã€‚
   - Stage
     Stageå—å®šä¹‰äº†åœ¨æ•´ä¸ª ipelineä¸­æ‰§è¡Œçš„æ¦‚å¿µä¸Šä¸åŒçš„ä»»åŠ¡å­é›†(ä¾‹å¦‚â€œæ„å»ºâ€,æµ‹è¯•â€å’Œéƒ¨ç½²â€**é˜¶æ®µ**)ï¼Œè®¸å¤šæ’ä»¶ä½¿ç”¨å®ƒæ¥å¯è§†åŒ–æˆ–å‘ˆç°Jenkinsç®¡é“çŠ¶æ€/è¿›åº¦ 
   - Step
     ä¸€é¡¹ä»»åŠ¡ã€‚ä»æ ¹æœ¬ä¸Šè®²,ä¸€ä¸ªæ­¥éª¤å‘Šè¯‰Jenkinsåœ¨ç‰¹å®šæ—¶é—´ç‚¹(æˆ–è¿‡ç¨‹ä¸­çš„â€œ**æ­¥éª¤**â€)è¦åšä»€ä¹ˆã€‚ä¾‹å¦‚,ä½¿ç”¨ sh  step:sh'make' å¯ä»¥æ‰§è¡Œmakeè¿™ä¸ªshe11å‘½ä»¤

###Jenkins file

â€‹	è„šæœ¬å¼è¯­æ³•æ ¼å¼:

```shell
pipeline{
	agent any 
	stages{
		stage("get code"){		
			steps{
				echo "get code from scm"
			}
		}
		stage("package"){			
			steps{
				echo "packge code"
			}
		}
		stage("deploy"){	
			steps{
				echo "deploy packge to nodel"
			}
		}    
	}
}
```



## åŸºæœ¬æ“ä½œ

### åˆ›å»ºä»»åŠ¡

- ä½¿ç”¨æœ¬åœ°è„šæœ¬

  1. æ–°å»ºItem-è¾“å…¥ä»»åŠ¡å-é€‰æ‹©`æµæ°´çº¿`

  2. General - å‹¾é€‰`Discard old builds`ä¸¢å¼ƒæ—§çš„æ„å»º     å¡«å…¥5å³å¯

  3. æµæ°´çº¿-é€‰æ‹©`Pipeline script`-å†™å…¥è„šæœ¬

     ![image-20210502112601065](æŒç»­é›†æˆ.assets/image-20210502112601065.png)

  4. ä¿å­˜æˆåŠŸåè¿›å…¥ä»»åŠ¡é¡µé¢-ç‚¹å‡»`Build Now`   

     ![image-20210502112621902](æŒç»­é›†æˆ.assets/image-20210502112621902.png)

  5. ç‚¹å‡»æ¯ä¸ªé˜¶æ®µçš„`logs`

     ![image-20210502112803286](æŒç»­é›†æˆ.assets/image-20210502112803286.png)

  

### ä½¿ç”¨è¿œç¨‹ä»“åº“è„šæœ¬

1. æµæ°´çº¿-é€‰æ‹©`Pipeline script from SCM`

   1. å¡«å…¥è¿œç¨‹ä»“åº“çš„ç›¸å…³ä¿¡æ¯

      ![image-20210502113409425](æŒç»­é›†æˆ.assets/image-20210502113409425.png)

   1. å°†è„šæœ¬æ¨é€è‡³gitlab ï¼Œå¹¶åœ¨Jenkinsæµæ°´çº¿é¡¹ç›®ä¸­å¡«å†™è„šæœ¬è·¯å¾„

      ![image-20210502114031301](æŒç»­é›†æˆ.assets/image-20210502114031301.png)

      ![image-20210502114058984](æŒç»­é›†æˆ.assets/image-20210502114058984.png)

      å¦‚æœä¸å¡«å†™çš„è¯ï¼Œç›´æ¥æ„å»ºä¼šæ„å»ºå¤±è´¥

      ![image-20210502113608045](æŒç»­é›†æˆ.assets/image-20210502113608045.png)

### ç»“åˆä»£ç è¿½è¸ªçš„æµæ°´çº¿è„šæœ¬

```shell
pipeline{
	agent any 
	stages{
		stage("get code"){		
			steps{
				echo "get code from scm"
			}
		}
		stage("unit test"){		
			steps{
				echo "unit test"
			}
		}
		stage("package"){			
			steps{
				sh 'tar -zcf /opt/web-${BUILD_ID}.tar.gz ./* --exclude=.git --exclude=Jenkinsfile'
			}
		}
		stage("deploy"){	
			steps{
        sh 'ssh root@192.168.1.111 "cd /usr/share/nginx/ && mkdir web-${BUILD_ID}"'
        sh 'scp /opt/web-${BUILD_ID}.tar.gz 192.168.1.111:/usr/share/nginx/web-${BUILD_ID}'
        sh 'ssh root@192.168.1.111 "cd /usr/share/nginx/web-${BUILD_ID} && tar xf web-${BUILD_ID}.tar.gz"'
        sh 'ssh root@192.168.1.111 "cd /usr/share/nginx/web-${BUILD_ID} && rm -rf web-${BUILD_ID}.tar.gz && rm -rf html "'	
        sh 'ssh root@192.168.1.111 "cd /usr/share/nginx/web-${BUILD_ID} && ln -s web-${BUILD_ID}  /usr/share/nginx/html"'
			}
		}    
	}
}
```

![image-20210502121922106](æŒç»­é›†æˆ.assets/image-20210502121922106.png)











# æ€»ç»“

![image-20210502102650911](æŒç»­é›†æˆ.assets/image-20210502102650911.png)

![image-20210502103035645](æŒç»­é›†æˆ.assets/image-20210502103035645.png)

![image-20210501232956617](æŒç»­é›†æˆ.assets/image-20210501232956617.png)

![image-20210501232909847](æŒç»­é›†æˆ.assets/image-20210501232909847.png)









# Gitå¸¸ç”¨æŒ‡ä»¤

```bash
git init				#åˆå§‹åŒ–ä»“åº“æŠŠä¸€ä¸ªç›®å½•åˆå§‹åŒ–ä¸ºç‰ˆæœ¬ä»“åº“(å¯ä»¥æ˜¯ç©ºçš„ç›®å½•ä¹Ÿå¯ä»¥æ˜¯å¸¯å†…å®¹çš„ç›®å½•) 
git status			#æŸ»çœ‹å½“å‰ä»“åº“çš„çŠ¶æ€

git add <æ–‡ä»¶å> 		#æ·»åŠ æ–‡ä»¶åˆ°æš‚å­˜åŒº
git add ./*		#æ·»åŠ å½“å‰æ‰€æœ‰æ–‡ä»¶åˆ°æš‚å­˜åŒº 

git rm --cached <æ–‡ä»¶å>		#æ’¤å‡ºæš‚å­˜åŒº
git rm -f <æ–‡ä»¶å>		#åŒæ—¶åˆ é™¤æš‚å­˜åŒºå’Œå·¥ä½œç›®å½•çš„æ–‡ä»¶

git commit -m   "æè¿°ä¿¡æ¯"		#ä»æš‚å­˜åŒºæäº¤åˆ°æœ¬åœ°ä»“åº“
git commit -am  "æè¿°ä¿¡æ¯"		#å¦‚æœæŸä¸ªæ–‡ä»¶å·²ç»è¢«ä»“åº“ç®¡ç†,å¦‚æœåœ¨æ›´æ”¹æ­¤æ–‡ä»¶ç›´æ¥éœ€è¦ä¸€æ¡å‘½ä»¤æäº¤å³å¯

git mv <old_name> <new_name>	#gitå‘½ä»¤ç›´æ¥æ›´æ”¹åç§°

git diff								#é»˜è®¤æ¯”å¯¹å·¥ä½œç›®å½•å’Œæš‚å­˜åŒº 
git diff	--cached			#æ¯”å¯¹æš‚å­˜åŒºå’Œæœ¬åœ°ä»“åº“

git log									# æŸ¥çœ‹å†å²å¿«ç…§
git log --oneline				# ä¸€è¡Œç®€å•çš„æ˜¾ç¤º Commitä¿¡æ¯
git log --oneline --decorate			# æ˜¾ç¤ºå½“å‰çš„æŒ‡é’ˆæŒ‡å‘å“ªé‡Œ
git log  -p							# æ˜¾ç¤ºå…·ä½“å†…å®¹çš„å˜åŒ–
git log  -1							# åªæ˜¾ç¤º1æ¡å†…å®¹

git reset --hard  <å“ˆå¸Œå€¼>/<æ ‡ç­¾>			 # å›æ»šæ•°æ®åˆ°æŸä¸€ä¸ªæäº¤
git reflog 							# å¯ä»¥æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯çš„æ‰€æœ‰æ“ä½œè®°å½•

git branch								# æŸ¥çœ‹åˆ†æ”¯
git branch <åˆ†æ”¯å>				# åˆ›å»ºåˆ†æ”¯
git branch -d <åˆ†æ”¯å>  		# åˆ é™¤åˆ†æ”¯

git checkout <åˆ†æ”¯å> 							# åˆ‡æ¢åˆ†æ”¯
git checkout -b <åˆ†æ”¯å>						# åˆ›å»ºå¹¶åˆ‡æ¢åˆ°åˆ†æ”¯

git merge <åˆ†æ”¯å>					#åˆå¹¶åˆ†æ”¯

git tag    							# æ˜¾ç¤ºå…¨éƒ¨æ ‡ç­¾
git tag -a <æ ‡ç­¾å>  <å“ˆå¸Œå€¼> -m <è¯´æ˜æ–‡å­—>   	# æ·»åŠ æ ‡ç­¾
git tag -d <æ ‡ç­¾å>			# åˆ é™¤æ ‡ç­¾

git remote													# æŸ¥çœ‹è¿œç¨‹åœ°å€
git remote add origin <SSHåœ°å€>			# æ·»åŠ è¿œç¨‹ä»“åº“åœ°å€ åç§°ä¸ºorigin
git remote rm  <æœ¬åœ°ä»“åº“å>					# åˆ é™¤è¿œç¨‹åœ°å€
git push -u origin <master/åˆ†æ”¯å>		# æ¨é€åˆ°è¿œç¨‹ä»“åº“
git pull 														# ä»è¿œç¨‹è·å–ä»£ç å¹¶åˆå¹¶æœ¬åœ°çš„ç‰ˆæœ¬
git clone  <SSHåœ°å€>								# ä»è¿œç¨‹ä»“åº“å…‹éš†åˆ°æœ¬åœ°ä»“åº“
```



# Gitå¸¸è§è‹±æ–‡

```bash
 1. branch		åˆ†æ”¯ 
 2. master		ä¸»
 3. conflict  å†²çª
```

